/*!
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016-2017  Wigii.org
 *  @author     <http://www.wigii.org/system/libs>      Wigii.org 
 *  @link       <http://www.wigii-system.net>     		<https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     		GNU General Public License
 */
(function(window,$){var wigiiNcdOptions=undefined;if(window.wigiiNcd&&window.wigiiNcd.options){wigiiNcdOptions=window.wigiiNcd.options}if(!wigiiNcdOptions){wigiiNcdOptions={}}if(!wigiiNcdOptions.privateNcdMembers){wigiiNcdOptions.privateNcdMembers={}}var ncdprivate=function(memberName){wigiiNcdOptions.privateNcdMembers[memberName]=true};var WigiiNcd=function(){var wigiiNcd=this;wigiiNcd.instantiationTime=Date.now();ncdprivate("instantiationTime");wigiiNcd.ctxKey="WigiiNcd_"+wigiiNcd.instantiationTime;wigiiNcd.context={};ncdprivate("context");wigiiNcd.errorCodes={UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,UNKNOWN_ERROR:1000,NOT_IMPLEMENTED:1001,WRAPPING:1002,UNSUPPORTED_OPERATION:1003,INVALID_ARGUMENT:1004,UNEXPECTED_ERROR:1005,DATA_INTEGRITY_ERROR:1006,DEPRECATED:1007,INVALID_STATE:1008,CONFIGURATION_ERROR:1009,OPERATION_CANCELED:1010,OUT_OF_BOUND:3100,ALREADY_EXISTS:3101,DOES_NOT_EXIST:3102,SYNTAX_ERROR:3800,SYMBOL_NOT_FOUND:4600,INVALID_RETURN_VALUE:4601,VARIABLE_NOT_DECLARED:4602,DIVISION_BY_ZERO:4603,ASSERTION_FAILED:4604};wigiiNcd.initializeErrorLabels=function(){if(!wigiiNcd.errorLabels){wigiiNcd.errorLabels={};for(var errName in wigiiNcd.errorCodes){wigiiNcd.errorLabels[wigiiNcd.errorCodes[errName]]=errName}}};ncdprivate("initializeErrorLabels");wigiiNcd.initializeErrorLabels();wigiiNcd.ServiceException=function(message,code,previous){var self=this;self.name="ServiceException";self.message=message;self.code=code||wigiiNcd.errorCodes.UNKNOWN_ERROR;self.previousException=previous};wigiiNcd.StringStack=function(){var self=this;self.className="StringStack";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.stack=[];self.popSubscribers=[];self.push=function(str){self.stack.push({start:str,content:"",end:undefined});return self};self.append=function(str){var top=undefined;if(self.stack.length>0){top=self.stack[self.stack.length-1]}if(!top){top={start:"",content:""+str,end:undefined};self.stack.push(top)}else{top.content+=str}return self};self.current=function(){if(self.stack.length>0){return self.stack[self.stack.length-1].content}else{return""}};self.reset=function(){self.stack=[]};self.pop=function(str){var top=self.stack.pop();if(!top){top={start:"",content:"",end:undefined}}top.end=""+str;if(self.popSubscribers.length>0){for(var i=0;i<self.popSubscribers.length;i++){self.popSubscribers[i](top.start,top.content,top.end)}}if(self.stack.length>0){self.stack[self.stack.length-1].content+=top.start+top.content+top.end}else{return top.start+top.content+top.end}};self.onPop=function(eventHandler){if(!$.isFunction(eventHandler)){throw wigiiNcd.createServiceException("pop event handler should be a function",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.popSubscribers.push(eventHandler)}};wigiiNcd.HtmlEmitter=function(output){var self=this;self.className="HtmlEmitter";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.options={};self.context={};self.impl={};self.modelers=[];self.children={};if(!output){output=$("body")}else{output=$(output)}self.$=function(){return output};self.emittedClass=function(cssClass){if(cssClass){self.options.emittedClass=cssClass}if(!self.options.emittedClass){self.options.emittedClass="ncd"}return self.options.emittedClass};self.addModeler=function(modeler){self.modelers.push(modeler);modeler(self);if(self.children){for(var i=0;i<self.children.length;i++){self.children[i].addModeler(modeler)}}return self};self.setCursor=function(node){self.context.cursor=output.find(node)};self.removeCursor=function(){self.context.cursor=undefined};self.put=function(str){self.htmlTree.append(str);return self};self.startH1=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("h1","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endH1=function(){self.impl.putHtml(self.htmlTree.pop("</h1>"));return self};self.startP=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("p","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endP=function(){self.impl.putHtml(self.htmlTree.pop("</p>"));return self};self.startSpan=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("span","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endSpan=function(){self.impl.putHtml(self.htmlTree.pop("</span>"));return self};self.startColor=function(color,backgroundColor,cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("span","class",self.emittedClass()+(cssClass?" "+cssClass:""),"style","color:"+color+";"+(backgroundColor?"margin:0.05em;padding:0.03em 0.1em;border-style:solid;border-radius:0.2em;background-color:"+backgroundColor+";border-color:"+color+";":"")).html());return self};self.endColor=function(){self.impl.putHtml(self.htmlTree.pop("</span>"));return self};self.startDelay=function(delay,cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("div","class",self.emittedClass()+(cssClass?" "+cssClass:""),"style","display:none;","data-ncd-delay",delay).html());return self};self.endDelay=function(){var delayedDiv=self.impl.putHtml(self.htmlTree.pop("</div>"),true);delayedDiv.delay(delayedDiv.attr("data-ncd-delay")*1000).fadeIn(700);return self};self.putButton=function(label,onClick,cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("button","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());self.htmlTree.append(label);var b=self.impl.putHtml(self.htmlTree.pop("</button>"),true);if($.isFunction(onClick)&&b){b.off().click(function(){if(window.wigiiNcdEtp&&window.wigiiNcdEtp.program.context){window.wigiiNcdEtp.program.context.html(self)}try{onClick()}catch(exc){self.publishException(exc)}})}return self};self.createGrid=function(nRows,nCols){return new wigiiNcd.Grid(self,nRows,nCols)};self.createTextArea=function(cssClass,index){return new wigiiNcd.TextArea(self,cssClass,index)};self.createTextInput=function(cssClass,index){return new wigiiNcd.TextInput(self,cssClass,index)};self.createPasswordInput=function(cssClass,index){return new wigiiNcd.PasswordInput(self,cssClass,index)};self.createCheckbox=function(cssClass,index){return new wigiiNcd.CheckBox(self,cssClass,index)};self.createUnorderedList=function(itemGenerator,itemRenderer,options){return new wigiiNcd.UnorderedList(self,itemGenerator,itemRenderer,options)};self.list=self.createUnorderedList;self.htmlBuilder=function(){return wigiiNcd.getHtmlBuilder(self)};self.div=function(id,cssClass){var returnValue=self.children[id];if(!returnValue){self.putHtml(wigiiNcd.getHtmlBuilder().putStartTag("div","class",self.emittedClass()+(cssClass?" "+cssClass:""),"id",id).putEndTag("div").html());returnValue=wigiiNcd.getHtmlEmitter(output.find("#"+id));if(self.modelers){for(var i=0;i<self.modelers.length;i++){returnValue.addModeler(self.modelers[i])}}self.children[id]=returnValue}return returnValue};self.clone=function(output){if(output===undefined){return self}var returnValue=wigiiNcd.getHtmlEmitter(output);if(self.modelers){for(var i=0;i<self.modelers.length;i++){returnValue.addModeler(self.modelers[i])}}return returnValue};self.reset=function(){self.children={};self.context={};output.empty();return self};self.clearErrors=function(){output.find("p."+self.emittedClass()+"-error").remove();return self};self.end=function(){self.impl.putHtml(self.htmlTree.pop(""));return self};self.publishException=function(exception){var htmlb=wigiiNcd.getHtmlBuilder();htmlb.putStartTag("p","class",self.emittedClass()+"-error").put(exception.code).prepend(" ",wigiiNcd.errorLabels[exception.code]).putBr().implode(" : ",exception.name,exception.message.replace(/</g,"&lt;").replace(/>/g,"&gt;")).putEndTag("p");self.impl.putHtml(htmlb.html());return self};self.putHtml=function(html){self.impl.putHtml(html);return self};self.impl.putHtml=function(html,returnLastCreated){if(self.context.cursor){self.context.cursor.before(html);if(returnLastCreated){return self.context.cursor.prev()}else{return output}}else{output.append(html);if(returnLastCreated){return output.children().last()}else{return output}}};self.htmlTree=wigiiNcd.createStringStackInstance();self.htmlTree.onPop(function(start,content,end){if(!start&&!end){return}var i=end.indexOf("</");var j=end.indexOf(">");var endtag=end.substring(i+2,j).trim();i=start.indexOf("<");j=start.indexOf(" ");var starttag=start.substring(i+1,j).trim();if(endtag!=starttag){throw wigiiNcd.createServiceException("invalid end tag '"+endtag+"' in context "+start+content.substr(0,64)+(content.length>64?"...":"")+end,wigiiNcd.errorCodes.SYNTAX_ERROR)}})};wigiiNcd.HtmlBuilder=function(htmlEmitter){var self=this;self.className="HtmlBuilder";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={htmlEmitter:htmlEmitter};self.buffer="";self.jsBuffer=[];self.differedQueue=[];self.html=function(){if(self.differedQueue.length>0){var returnValue="";for(var i=0;i<self.differedQueue.length;i++){var f=self.differedQueue[i];if($.isFunction(f)){var r=f();if(r!==undefined){returnValue+=r}}else{if($.isPlainObject(f)){var r=f.fx.apply(null,f.args);if(r!==undefined){returnValue+=r}}else{returnValue+=f}}}returnValue+=self.buffer;return returnValue}else{return self.buffer}};self.emit=function(htmlEmitter){if(!htmlEmitter){htmlEmitter=self.context.htmlEmitter}if(htmlEmitter){var htmls="";if(self.differedQueue.length>0){var insertionTags=[];for(var i=0;i<self.differedQueue.length;i++){var f=self.differedQueue[i];if($.isFunction(f)){f={fx:f}}if($.isPlainObject(f)){f.id=self.ctxKey+"_"+i;htmls+='<span id="'+f.id+'"></span>';insertionTags.push(f)}else{htmls+=f}}if(self.buffer!=""){htmls+=self.buffer}htmlEmitter.putHtml(htmls);if(insertionTags.length>0){for(var i=0;i<insertionTags.length;i++){var insertionTag=htmlEmitter.$().find("#"+insertionTags[i].id);if(insertionTag){htmlEmitter.setCursor(insertionTag);if(window.wigiiNcdEtp&&window.wigiiNcdEtp.program.context){window.wigiiNcdEtp.program.context.html(htmlEmitter)}var r=insertionTags[i];r=r.fx.apply(null,r.args);if(r!==undefined){htmlEmitter.putHtml(r)}htmlEmitter.removeCursor();insertionTag.remove()}}}}else{if(self.buffer!=""){htmlEmitter.putHtml(self.buffer)}}return htmlEmitter}};self.runJsCode=function(){for(var i=0;i<self.jsBuffer.length;i++){var jsCode=self.jsBuffer[i];if($.isFunction(jsCode)){jsCode()}}return self};self.reset=function(){self.buffer="";self.jsBuffer=[];self.differedQueue=[];return self};self.put=function(str){if(str){self.buffer+=str}return self};self.implode=function(sep){if(arguments.length>1){var i=1;var result="",value;while(i<arguments.length){value=arguments[i];if(value){if(result){result+=sep}result+=value}i++}self.buffer+=result}return self};self.prepend=function(prefix,str){if(str){self.buffer+=prefix+str}return self};self.putNbsp=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="&nbsp;"}return self};self.putBr=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="<br/>"}return self};self.putQuot=function(){self.buffer+="&quot;";return self};self.putAmp=function(){self.buffer+="&amp;";return self};self.putLt=function(){self.buffer+="&lt;";return self};self.putGt=function(){self.buffer+="&gt;";return self};self.putApos=function(){self.buffer+="&apos;";return self};self.putHashTag=function(){self.buffer+="#";return self};self.putStartTag=function(tagName){if(!tagName){throw wigiiNcd.createServiceException("putStartTag takes a non null tagName",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.buffer+="<"+tagName;if(arguments.length>1){var i=1;var key,value;while(i<arguments.length){key=arguments[i];if(!key){throw wigiiNcd.createServiceException("html attribute name cannot be null",wigiiNcd.errorCodes.INVALID_ARGUMENT)}i++;if(i<arguments.length){value=arguments[i];i++}else{value=""}if(value!==""&&value!==undefined){self.buffer+=" "+key+'="'+value+'"'}}}self.buffer+=">";return self};self.putEndTag=function(tagName){if(!tagName){throw wigiiNcd.createServiceException("putEndTag takes a non null tagName",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.buffer+="</"+tagName+">";return self};self.putHtmlHeader=function(){self.buffer+="<!DOCTYPE html>";return self};self.putJsCode=function(actions){var actionType=$.type(actions);if(actionType==="function"){self.jsBuffer.push(actions)}else{if(actionType==="string"){self.jsBuffer.push(function(){eval(actions)})}}return self};self.putHtmlBuilder=function(htmlBuilder){if(htmlBuilder){self.put(htmlBuilder.html());for(var i=0;i<htmlBuilder.jsBuffer.length;i++){self.putJsCode(htmlBuilder.jsBuffer[i])}}return self};self.insert=function(f){if(f){var args;if(arguments.length>1){args=Array.prototype.slice.call(arguments,1)}else{args=[]}if(self.buffer!=""){self.differedQueue.push(self.buffer);self.buffer=""}self.differedQueue.push((args.length>0?{fx:f,args:args}:f))}return self};self.tag=self.putStartTag;self.$tag=self.putEndTag;self.nbsp=self.putNbsp;self.br=self.putBr;self.amp=self.putAmp;self.apos=self.putApos;self.quot=self.putQuot;self.hashTag=self.putHashTag;self.gt=self.putGt;self.lt=self.putLt;self.out=self.put};wigiiNcd.Grid=function(htmlEmitter,nRows,nCols){var self=this;self.className="Grid";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={};self.context.rows=[];var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("table","class",htmlEmitter.emittedClass(),"id",self.ctxKey);for(var i=0;i<nRows;i++){htmlB.putStartTag("tr","class",htmlEmitter.emittedClass());self.context.rows.push([]);for(var j=0;j<nCols;j++){var id=self.ctxKey+"_"+i+"_"+j;htmlB.putStartTag("td","class",htmlEmitter.emittedClass(),"id",id);self.context.rows[i].push(new wigiiNcd.GridCell(self,i,j,id));htmlB.putNbsp(4);htmlB.putEndTag("td")}htmlB.putEndTag("tr")}htmlB.putEndTag("table");htmlEmitter.putHtml(htmlB.html());self.cell=function(x,y){if(x<0||x>=nRows){return undefined}if(y<0||y>=nCols){return undefined}return self.context.rows[x][y]};self.nRows=function(){return nRows};self.nCols=function(){return nCols}};wigiiNcd.GridCell=function(grid,x,y,id){var self=this;self.className="GridCell";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.context={};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+id).html(txt);return self}};self.color=function(c){if(c===undefined){return self.context.color}else{self.context.color=c;$("#"+id).css("background-color",c);return self}};self.left=function(wrap){var neighbour=y-1;if(neighbour<0){if(wrap){neighbour=grid.nCols()-1}else{return undefined}}return grid.cell(x,neighbour)};self.right=function(wrap){var neighbour=y+1;if(neighbour>=grid.nCols()){if(wrap){neighbour=0}else{return undefined}}return grid.cell(x,neighbour)};self.up=function(wrap){var neighbour=x-1;if(neighbour<0){if(wrap){neighbour=grid.nRows()-1}else{return undefined}}return grid.cell(neighbour,y)};self.down=function(wrap){var neighbour=x+1;if(neighbour>=grid.nRows()){if(wrap){neighbour=0}else{return undefined}}return grid.cell(neighbour,y)};self.offset=function(x,y){var newX=(self.x()+x)%grid.nRows();var newY=(self.y()+y)%grid.nCols();return grid.cell(newX,newY)};self.grid=function(){return grid};self.x=function(){return x};self.y=function(){return y};self.id=function(){return id};self.click=function(onClick){if($.isFunction(onClick)){$("#"+id).off("click").click(function(){onClick(self)})}else{if(onClick===undefined){$("#"+id).click()}}return self}};wigiiNcd.TextArea=function(htmlEmitter,cssClass,index){var self=this;self.className="TextArea";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("textarea","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("textarea");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}};wigiiNcd.TextInput=function(htmlEmitter,cssClass,index){var self=this;self.className="TextInput";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","text","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}};wigiiNcd.PasswordInput=function(htmlEmitter,cssClass,index){var self=this;self.className="PasswordInput";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","password","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}};wigiiNcd.TextInputWrapper=function(txtInput,cssClass,index){var self=this;self.className="TextInputWrapper";txtInput=$(txtInput);if(txtInput.attr("id")){self.ctxKey=txtInput.attr("id")}else{self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");txtInput.attr("id",self.ctxKey)}if(cssClass){txtInput.addClass(cssClass)}self.context={index:index};self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}};wigiiNcd.CheckBox=function(htmlEmitter,cssClass,index){var self=this;self.className="CheckBox";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};self.$=function(){return $("#"+self.ctxKey)};self.checked=function(bool){if(bool===undefined){return self.context.checked}else{self.context.checked=(bool==true);$("#"+self.ctxKey).prop("checked",bool);return self}};self.onClick=function(onClick){if($.isFunction(onClick)){self.context.onClickSubscribers.push(onClick)}else{if(onClick===undefined){if(self.context.onClickSubscribers){for(var i=0;i<self.context.onClickSubscribers.length;i++){var eh=self.context.onClickSubscribers[i];if($.isFunction(eh)){eh(self,self.context.checked==true)}}}}}return self};self.toggle=function(){self.checked(!self.checked());return self};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","checkbox","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());if(!self.context.onClickSubscribers){self.context.onClickSubscribers=[];$("#"+self.ctxKey).click(function(){self.toggle();self.onClick()})}};wigiiNcd.UnorderedList=function(htmlEmitter,itemGenerator,itemRenderer,options){var self=this;self.className="UnorderedList";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.options=options||{};self.impl={};self.context={items:[],selection:{},selectedCount:0,currentItem:undefined};if(self.options.selectedClass===undefined){self.options.selectedClass="selected"}if(self.options.highlightedClass===undefined){self.options.highlightedClass="highlighted"}self.$=function(){return $("ul#"+self.ctxKey)};self.size=function(){return self.context.items.length};self.items=function(){return self.context.items};self.selection=function(){var returnValue={};for(var i in self.context.selection){if(self.context.selection[i]){returnValue[i]=self.context.items[i-1]}}return returnValue};self.selected=function(i,bool){if(i===undefined&&bool===undefined){return self.context.selectedCount}if(i<1||self.size()<i){throw wncd.createServiceException("index "+i+" is out of list range.",wncd.errorCodes.OUT_OF_BOUND)}if(bool===undefined){return(self.context.selection[i]==true)}else{if(bool&&self.options.maxSelection>1&&self.context.selectedCount>=self.options.maxSelection){throw wncd.createServiceException("A maximum of "+self.options.maxSelection+" items can be selected.",wncd.errorCodes.ASSERTION_FAILED)}else{if(bool&&self.options.maxSelection==1&&self.context.selectedCount==1){self.selected(Object.keys(self.selection())[0],false)}}self.context.selection[i]=(bool==true);var li=self.$().find("> li:nth-child("+i+")");if(self.context.selection[i]){if(self.options.unselectedClass){li.removeClass(self.options.unselectedClass)}li.addClass(self.options.selectedClass);self.context.selectedCount++}else{li.removeClass(self.options.selectedClass);if(self.context.unselectedClass){li.addClass(self.options.unselectedClass)}self.context.selectedCount--}return self}};self.toggle=function(i){self.selected(i,!self.selected(i));return self};self.onItemClick=function(onClick){if($.isFunction(onClick)){self.options.onItemClick=onClick}else{self.impl.onItemClick(onClick)}return self};self.add=function(item){var n=self.size();if(item!==undefined){var htmlB=self.$().wncd("html").htmlBuilder();self.context.items.push(item);n++;self.impl.buildLi(n,item,htmlB);htmlB.emit();self.$().find("> li:nth-child("+n+")").click(self.impl.onLiClick)}return self};self.highLight=function(i,outputOption){if(i!==undefined){if(i<1||self.size()<i){throw wncd.createServiceException("index "+i+" is out of list range.",wncd.errorCodes.OUT_OF_BOUND)}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}self.context.currentItem=i}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.clearHighLight=function(){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass);self.context.currentItem=undefined}return self};self.next=function(wrap,outputOption){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}if(self.context.currentItem===undefined){self.context.currentItem=1}else{if(self.context.currentItem>=self.size()){if(wrap){self.context.currentItem=1}else{self.context.currentItem=undefined}}else{self.context.currentItem++}}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.previous=function(wrap,outputOption){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}if(self.context.currentItem===undefined){self.context.currentItem=self.size()}else{if(self.context.currentItem<=1){if(wrap){self.context.currentItem=self.size()}else{self.context.currentItem=undefined}}else{self.context.currentItem--}}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.impl.buildLi=function(n,item,htmlB){var itemHtml=itemRenderer(n,item,self);if(itemHtml){if($.type(itemHtml)==="object"){var tagArgs=["li","class",htmlEmitter.emittedClass()+(self.context.unselectedClass?" "+self.context.unselectedClass:"")+(itemHtml["class"]?" "+itemHtml["class"]:"")];var plainHtml="";itemHtml["class"]=undefined;for(var key in itemHtml){if(key=="html"){plainHtml=itemHtml[key]}else{if(itemHtml[key]){tagArgs.push(key);tagArgs.push(itemHtml[key])}}}htmlB.tag.apply(undefined,tagArgs).put(plainHtml).$tag("li")}else{htmlB.tag("li","class",htmlEmitter.emittedClass()+(self.context.unselectedClass?" "+self.context.unselectedClass:"")).put(itemHtml).$tag("li")}}};var htmlB=htmlEmitter.htmlBuilder();htmlB.tag("ul","id",self.ctxKey,"class",htmlEmitter.emittedClass()+(options.cssClass?" "+options.cssClass:""));var shouldContinue=true;var n=0;while(shouldContinue){var item=itemGenerator(n,self);if(item!==undefined){self.context.items.push(item);n++;self.impl.buildLi(n,item,htmlB)}else{shouldContinue=false}}htmlB.$tag("ul").emit();self.impl.onItemClick=function(i){self.toggle(i);if($.isFunction(self.options.onItemClick)){self.options.onItemClick(i,self.context.items[i-1],self.selected(i),self)}};self.impl.onLiClick=function(e){try{self.impl.onItemClick($(this).index()+1)}catch(exc){if(!(self.options.maxSelection>1&&exc.code==wncd.errorCodes.ASSERTION_FAILED)){htmlEmitter.publishException(exc)}}e.stopPropagation()};self.$().find("> li").click(self.impl.onLiClick)};wigiiNcd.GridTurtle=function(grid,headColor,tailColor){var self=this;headColor=headColor||"red";tailColor=tailColor||"blue";if(!grid){throw wigiiNcd.createServiceException("grid cannot be null",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.context={};self.start=function(x,y,direction){direction=direction||"N";switch(direction){case"N":case"S":case"E":case"W":self.context.direction=direction;break;default:throw wigiiNcd.createServiceException("invalid direction '"+direction+"'",wigiiNcd.errorCodes.INVALID_ARGUMENT)}if(grid.cell(x,y)){self.context.x=x;self.context.y=y}else{throw wigiiNcd.createServiceException("invalid start coordinates ("+x+","+y+")",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.show()};self.moveForward=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.moveForwardAndLeft=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true).left(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true).right(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true).up(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true).down(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.moveForwardAndRight=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true).right(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true).left(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true).down(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true).up(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.turnBack=function(){switch(self.context.direction){case"N":self.context.direction="S";break;case"S":self.context.direction="N";break;case"E":self.context.direction="W";break;case"W":self.context.direction="E";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.turnLeft=function(){switch(self.context.direction){case"N":self.context.direction="W";break;case"S":self.context.direction="E";break;case"E":self.context.direction="N";break;case"W":self.context.direction="S";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.turnRight=function(){switch(self.context.direction){case"N":self.context.direction="E";break;case"S":self.context.direction="W";break;case"E":self.context.direction="S";break;case"W":self.context.direction="N";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.previous={x:undefined,y:undefined,text:undefined,color:undefined};self.show=function(){var c;if(self.previous.x!==undefined&&self.previous.y!==undefined){c=grid.cell(self.previous.x,self.previous.y);c.text(" ").color(tailColor)}c=grid.cell(self.context.x,self.context.y);self.previous.x=self.context.x;self.previous.y=self.context.y;self.previous.text=c.text();self.previous.color=c.color();var headTxt="";switch(self.context.direction){case"N":headTxt="&#9650;";break;case"S":headTxt="&#9660;";break;case"W":headTxt="&#9664;";break;case"E":headTxt="&#9654;";break}c.text(headTxt).color(headColor)};self.grid=function(){return grid};self.currentCell=function(){return grid.cell(self.context.x,self.context.y)};self.cell=function(x,y){var e1x=0,e1y=0,e2x=0,e2y=0;switch(self.context.direction){case"N":e1x=-1;e1y=0;e2x=0;e2y=1;break;case"S":e1x=1;e1y=0;e2x=0;e2y=-1;break;case"E":e1x=0;e1y=1;e2x=1;e2y=0;break;case"W":e1x=0;e1y=-1;e2x=-1;e2y=0;break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}var rx=(self.context.x+x*e1x+y*e1y)%grid.nRows();if(rx<0){rx=grid.nRows()+rx}var ry=(self.context.y+x*e2x+y*e2y)%grid.nCols();if(ry<0){ry=grid.nCols()+ry}return grid.cell(rx,ry)}};wigiiNcd.SelectionSense=function(onClick,options){var self=this;self.className="SelectionSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={selected:false,selectedClass:"selected",unselectedClass:undefined};if(options){if(options.selectedClass){self.context.selectedClass=options.selectedClass}if(options.unselectedClass){self.context.unselectedClass=options.unselectedClass}}self.onClick=function(){self.toggle();if($.isFunction(onClick)){onClick(self)}};self.anchors=[];self.selected=function(bool){if(bool===undefined){return self.context.selected}else{self.context.selected=(bool==true);for(var i=0;i<self.anchors.length;i++){var anchor=self.anchors[i];if(self.context.selected){if(self.context.unselectedClass){anchor.removeClass(self.context.unselectedClass)}anchor.addClass(self.context.selectedClass)}else{anchor.removeClass(self.context.selectedClass);if(self.context.unselectedClass){anchor.addClass(self.context.unselectedClass)}}}return self}};self.toggle=function(){self.selected(!self.selected());return self};self.bind=function(anchor){anchor.click(self.onClick);anchor.css("cursor","pointer");self.anchors.push(anchor);if(self.context.selected){if(self.context.unselectedClass){anchor.removeClass(self.context.unselectedClass)}anchor.addClass(self.context.selectedClass)}else{anchor.removeClass(self.context.selectedClass);if(self.context.unselectedClass){anchor.addClass(self.context.unselectedClass)}}return self}};wigiiNcd.CountingSense=function(onClick,options){var self=this;self.className="CountingSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={counter:0};self.onClick=function(){if($.isFunction(onClick)){onClick(self)}else{self.inc()}};self.anchors=[];self.count=function(){return self.context.counter};self.reset=function(defaultValue){if(defaultValue!==undefined){self.context.counter=defaultValue}else{self.context.counter=0}return self};self.inc=function(val){if(val!==undefined){self.context.counter+=val}else{self.context.counter+=1}return self};self.dec=function(val){if(val!==undefined){self.context.counter-=val}else{self.context.counter-=1}return self};self.bind=function(anchor){anchor.click(self.onClick);anchor.css("cursor","pointer");self.anchors.push(anchor);return self}};wigiiNcd.AutocompletionSense=function(propositionGenerator,options){var self=this;self.className="AutocompletionSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.options=options||{};self.impl={};self.context={interactivePanelReady:false};if($.isFunction(propositionGenerator)){self.impl.propositionGenerator=propositionGenerator}else{if($.isArray(propositionGenerator)){self.impl.propositionGenerator=function(n,txt,list){if(list.context.visited===undefined){list.context.visited=0}while(list.context.visited<propositionGenerator.length){var returnValue=propositionGenerator[list.context.visited++];if(returnValue.toLowerCase().indexOf(txt.toLowerCase())>=0){return returnValue}}}}}if(!self.options.matchClass){self.options.matchClass="match"}if(!self.options.matchTag){self.options.matchTag="strong"}if(!self.options.renderProposition){self.options.renderProposition=function(i,data,list){if(!list.context.txtLowerCase){list.context.txtLowerCase=list.context.txt.toLowerCase();list.context.txtLength=list.context.txt.length}var txtPos=data.toLowerCase().indexOf(list.context.txtLowerCase);var returnValue=data;if(txtPos>=0){returnValue=wncd.getHtmlBuilder().out(data.substr(0,txtPos)).tag(self.options.matchTag,"class",self.options.matchClass).out(data.substr(txtPos,list.context.txtLength)).$tag(self.options.matchTag).out(data.substr(txtPos+list.context.txtLength)).html()}return returnValue}}if(!self.options.actionOnChosenProposition){self.options.actionOnChosenProposition="replace"}if(!self.options.updateTextWithProposition){self.options.updateTextWithProposition=function(txt,proposition){if(self.options.actionOnChosenProposition=="replace"){return proposition}else{if(self.options.actionOnChosenProposition=="append"){return txt+proposition}else{if(self.options.actionOnChosenProposition=="prepend"){return proposition+txt}}}}}self.$=function(){return $("#"+self.ctxKey)};self.chooseOne=function(txt,choiceCallback){if(!self.context.interactivePanelReady){self.impl.initializeInteractivePanel()}self.options.panel.reset();self.context.list=self.options.panel.list(function(n,list){list.context.txt=txt;return self.impl.propositionGenerator(n,txt,list)},self.options.renderProposition,{onItemClick:function(i,data,selected){if(selected){choiceCallback(self.options.updateTextWithProposition(txt,data));self.options.panel.reset();self.context.list=undefined;if(self.options.hideOnSelection){self.options.panel.$().hide()}}},maxSelection:1});self.context.list.$().find("> li").on("hover",function(){self.context.list.highLight($(this).index()+1)});if(self.options.hideOnSelection){self.options.panel.$().show()}self.options.panel.$().scrollTop(0);return self};self.bind=function(txtInput){if(!self.context.interactivePanelReady){self.impl.initializeInteractivePanel(txtInput)}var txtInputSetText=function(txt){txtInput.text(txt);txtInput.$().change().focus()};txtInput.onInput(function(txtInput,txt){self.chooseOne(txt,txtInputSetText)})};self.impl.initializeInteractivePanel=function(txtInput){if(!self.options.panel){if(self.options.hideOnSelection===undefined){self.options.hideOnSelection=true}var anchor=txtInput.$();anchor.parent().css("overflow","visible");anchor.after(wigiiNcd.getHtmlBuilder().tag("div","id",self.ctxKey,"class","autocompletionsense"+(self.options.cssClass?" "+self.options.cssClass:""),"style","position:relative;"+(self.options.hideOnSelection?"display:none;":"")).$tag("div").html());self.options.panel=wncd.html(self.$())}else{if($.type(self.options.panel)==="string"||self.options.panel.className!="HtmlEmitter"){self.options.panel=wncd.html(self.options.panel).div(self.ctxKey,"autocompletionsense"+(self.options.cssClass?" "+self.options.cssClass:""))}}txtInput.$().on("keydown",function(e){if(e.key=="Up"||e.key=="ArrowUp"){if(self.context.list){var i=self.context.list.previous(true,"index");var p=self.options.panel.$();var li=self.context.list.$().find("> li:nth-child("+i+")");if(i==self.context.list.size()){p.scrollTop(li.offset().top)}else{if(li.offset().top<p.offset().top){p.scrollTop(Math.max(p.scrollTop()-li.height(),0))}}}}else{if(e.key=="Down"||e.key=="ArrowDown"){if(self.context.list){var i=self.context.list.next(true,"index");var p=self.options.panel.$();if(i==1){p.scrollTop(0)}else{var li=self.context.list.$().find("> li:nth-child("+i+")");if(li.offset().top+li.height()>p.offset().top+p.height()){p.scrollTop(p.scrollTop()+li.height())}}}}}}).on("keypress",function(e){if(self.options.hideOnSelection&&(e.key=="Esc"||e.key=="Escape"||!$(this).val()&&e.key=="Backspace")){self.options.panel.$().hide();if(self.context.list){self.context.list.clearHighLight()}}else{if(e.key=="Enter"){var i=(self.context.list?self.context.list.highLight(undefined,"index"):undefined);if(i){self.context.list.onItemClick(i)}else{if(self.options.hideOnSelection){self.options.panel.$().hide()}}}}});self.options.panel.out("ready");self.context.interactivePanelReady=true}};wigiiNcd.JQueryService=function(){var self=this;self.className="JQueryService";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.HtmlEmitter=function(selection,options){var returnValue=undefined;if(selection&&selection.length==1){returnValue=wncd.html(selection)}else{if(selection&&selection.length>1){throw wigiiNcd.createServiceException("Wigii NCD HtmlEmitter selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiNcd.errorCodes.INVALID_ARGUMENT)}}return(!returnValue?{$:selection}:returnValue)};self.html=self.HtmlEmitter;self.wrap=function(selection,options){var returnValue=undefined;if(selection&&selection.length==1){returnValue=wigiiNcd.wrapTextInput(selection,options)}else{if(selection&&selection.length>1){throw wigiiNcd.createServiceException("Wigii NCD wrap selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiNcd.errorCodes.INVALID_ARGUMENT)}}return(!returnValue?{$:selection}:returnValue)}};wigiiNcd.createStringStackInstance=function(){return new wigiiNcd.StringStack()};wigiiNcd.getHtmlEmitter=function(output){return new wigiiNcd.HtmlEmitter(output)};wigiiNcd.getHtmlBuilder=function(htmlEmitter){return new wigiiNcd.HtmlBuilder(htmlEmitter)};wigiiNcd.createSelectionSense=function(onClick,options){return new wigiiNcd.SelectionSense(onClick,options)};wigiiNcd.bindSelectionSense=function(anchor,onClick,options){return wigiiNcd.createSelectionSense(onClick,options).bind(anchor)};wigiiNcd.createCountingSense=function(onClick,options){return new wigiiNcd.CountingSense(onClick,options)};wigiiNcd.bindCountingSense=function(anchor,onClick,options){return wigiiNcd.createCountingSense(onClick,options).bind(anchor)};wigiiNcd.createAutoCompletionSense=function(propositionGenerator,options){return new wigiiNcd.AutocompletionSense(propositionGenerator,options)};wigiiNcd.bindAutoCompletionSense=function(txtInput,propositionGenerator,options){return wigiiNcd.createAutoCompletionSense(propositionGenerator,options).bind(txtInput)};wigiiNcd.wrapTextInput=function(txtInput,cssClass){return new wigiiNcd.TextInputWrapper(txtInput,cssClass)};wigiiNcd.getJQueryService=function(){if(!wigiiNcd.jQueryServiceInstance){wigiiNcd.jQueryServiceInstance=new wigiiNcd.JQueryService();ncdprivate("jQueryServiceInstance")}return wigiiNcd.jQueryServiceInstance};wigiiNcd.throwNotImplemented=function(){throw new wigiiNcd.ServiceException("not implemented",wigiiNcd.errorCodes.NOT_IMPLEMENTED)};wigiiNcd.createServiceException=function(message,code,previous){return new wigiiNcd.ServiceException(message,code,previous)};wigiiNcd.obj2FxString=function(obj){var objType=$.type(obj);if(objType==="function"){if($.isFunction(obj.toFxString)){return obj.toFxString()}else{return obj.toString()}}else{if(objType==="number"){return obj}else{if(objType==="boolean"){return obj.toString()}else{if(objType==="string"){return'"'+obj.replace(/"/g,'\\"')+'"'}else{if(objType==="object"){return"JSON.parse('"+JSON.stringify(obj)+"')"}else{if(obj===undefined){return'""'}else{return'"'+obj.toString()+'"'}}}}}}};wigiiNcd.fxString2obj=function(str){if(str){var wigiiNcd=window.wigiiNcd;var returnValue=eval(str);return returnValue}};wigiiNcd.updateObjIfChanged=function(obj1,obj2){if(!obj1||!obj2){throw wigiiNcd.createServiceException("obj1 and obj2 cannot be null.",wigiiNcd.errorCodes.INVALID_ARGUMENT)}var updateChain={context:{obj1:obj1,obj2:obj2,changes:false}};updateChain.field=function(fieldName){if(updateChain.context.obj2[fieldName]!=updateChain.context.obj1[fieldName]){updateChain.context.obj1[fieldName]=updateChain.context.obj2[fieldName];updateChain.context.changes=true}return updateChain};updateChain.set=function(fieldName,value,subFieldName){if(updateChain.context.changes){if(subFieldName!==undefined){updateChain.context.obj1[fieldName][subFieldName]=value}else{updateChain.context.obj1[fieldName]=value}}return updateChain};updateChain.hasChanges=function(){return updateChain.context.changes};return updateChain};wigiiNcd.txtDate=function(timestamp){var d=($.type(timestamp)=="date"?timestamp:new Date(timestamp));var returnValue="";var v=0;returnValue+=d.getFullYear();returnValue+="-";v=d.getMonth()+1;if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+="-";v=d.getDate();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=" ";v=d.getHours();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getMinutes();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getSeconds();if(v<10){returnValue+="0"+v}else{returnValue+=v}return returnValue};wigiiNcd.txtFrenchDate=function(timestamp,options){var d=($.type(timestamp)=="date"?timestamp:new Date(timestamp));var returnValue="";var v=0;if(options!="noDate"){v=d.getDate();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";v=d.getMonth()+1;if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";returnValue+=d.getFullYear()}if(options!="noTime"){if(options!="noDate"){returnValue+=" "}v=d.getHours();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getMinutes();if(v<10){returnValue+="0"+v}else{returnValue+=v}if(options!="noSeconds"){returnValue+=":";v=d.getSeconds();if(v<10){returnValue+="0"+v}else{returnValue+=v}}}return returnValue};wigiiNcd.html=function(output){return wigiiNcd.getHtmlEmitter(output)};wigiiNcd.version=function(){return"2.0"}};var wigiiNcdInstance=new WigiiNcd();var wigiiNcdFacade=function(selector,options){var wigiiNcd=wigiiNcdInstance;return wigiiNcd};if(!$.isFunction(window.wigiiNcd)||window.wigiiNcd().version()<wigiiNcdFacade().version()){window.wigiiNcd=wigiiNcdFacade;if(wigiiNcdOptions.publishNcdToWncd===undefined){wigiiNcdOptions.publishNcdToWncd=function(wigiiNcd,wncd){for(var member in wigiiNcd){if(!wigiiNcdOptions.privateNcdMembers[member]){wncd[member]=wigiiNcd[member]}}}}window.wncd={};if(wigiiNcdOptions.publishNcdToWncd){wigiiNcdOptions.publishNcdToWncd(wigiiNcdInstance,window.wncd)}}})(window,jQuery);(function(a){a.fn.wncd=function(h,d){var f=wigiiNcd();var g=undefined;try{if(!h){throw f.createServiceException("cmd cannot be null",f.errorCodes.INVALID_ARGUMENT)}var c=f.getJQueryService()[h];if(!c||a.type(c)!=="function"){throw f.createServiceException("Wigii NCD JQueryService does not support the '"+h+"' command.",f.errorCodes.UNSUPPORTED_OPERATION)}g=c(this,d)}catch(j){if(window.wigii){wigii().publishException(j)}else{throw j}}if(g){return g}else{return this}}})(jQuery);(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var j=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var k=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){j.shft=true}if(17==l){j.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){j.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!j.ctrl&&!j.alt){m.preventDefault;j.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),j.shft,k);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){j.shft=false}}).bind("blur",function(l){if(9==j.last){e(l.target).one("focus",function(m){j.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(k,j,h){var g=k.scrollTop;if(k.setSelectionRange){a(k,j,h)}else{if(document.selection){d(k,j,h)}}k.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function a(k,g,w){var v=k.selectionStart;var t=k.selectionEnd;if(v==t){if(g){if("\t"==k.value.substring(v-w.tabString.length,v)){k.value=k.value.substring(0,v-w.tabString.length)+k.value.substring(v);k.focus();k.setSelectionRange(v-w.tabString.length,v-w.tabString.length)}else{if("\t"==k.value.substring(v,v+w.tabString.length)){k.value=k.value.substring(0,v)+k.value.substring(v+w.tabString.length);k.focus();k.setSelectionRange(v,v)}}}else{k.value=k.value.substring(0,v)+w.tabString+k.value.substring(v);k.focus();k.setSelectionRange(v+w.tabString.length,v+w.tabString.length)}}else{var x=k.value.split("\n");var u=new Array();var m=0;var j=0;var h=false;for(var q in x){j=m+x[q].length;u.push({start:m,end:j,selected:(m<=v&&j>v)||(j>=t&&m<t)||(m>v&&j<t)});m=j+1}var l=0;for(var q in u){if(u[q].selected){var s=u[q].start+l;if(g&&w.tabString==k.value.substring(s,s+w.tabString.length)){k.value=k.value.substring(0,s)+k.value.substring(s+w.tabString.length);l-=w.tabString.length}else{if(!g){k.value=k.value.substring(0,s)+w.tabString+k.value.substring(s);l+=w.tabString.length}}}}k.focus();var r=v+((l>0)?w.tabString.length:(l<0)?-w.tabString.length:0);var n=t+l;k.setSelectionRange(r,n)}}function d(s,y,g){var r=document.selection.createRange();if(s==r.parentElement()){if(""==r.text){if(y){var m=r.getBookmark();r.moveStart("character",-g.tabString.length);if(g.tabString==r.text){r.text=""}else{r.moveToBookmark(m);r.moveEnd("character",g.tabString.length);if(g.tabString==r.text){r.text=""}}r.collapse(true);r.select()}else{r.text=g.tabString;r.collapse(false);r.select()}}else{var l=r.text;var q=l.length;var w=l.split("\r\n");var B=document.body.createTextRange();B.moveToElementText(s);B.setEndPoint("EndToStart",r);var n=B.text;var z=n.split("\r\n");var t=n.length;var A=document.body.createTextRange();A.moveToElementText(s);A.setEndPoint("StartToEnd",r);var x=A.text;var h=document.body.createTextRange();h.moveToElementText(s);h.setEndPoint("StartToEnd",B);var u=h.text;var j=e(s).html();e("#r3").text(t+" + "+q+" + "+x.length+" = "+j.length);if((t+u.length)<j.length){z.push("");t+=2;if(y&&g.tabString==w[0].substring(0,g.tabString.length)){w[0]=w[0].substring(g.tabString.length)}else{if(!y){w[0]=g.tabString+w[0]}}}else{if(y&&g.tabString==z[z.length-1].substring(0,g.tabString.length)){z[z.length-1]=z[z.length-1].substring(g.tabString.length)}else{if(!y){z[z.length-1]=g.tabString+z[z.length-1]}}}for(var v=1;v<w.length;v++){if(y&&g.tabString==w[v].substring(0,g.tabString.length)){w[v]=w[v].substring(g.tabString.length)}else{if(!y){w[v]=g.tabString+w[v]}}}if(1==z.length&&0==t){if(y&&g.tabString==w[0].substring(0,g.tabString.length)){w[0]=w[0].substring(g.tabString.length)}else{if(!y){w[0]=g.tabString+w[0]}}}if((t+q+x.length)<j.length){w.push("");q+=2}B.text=z.join("\r\n");r.text=w.join("\r\n");var k=document.body.createTextRange();k.moveToElementText(s);if(0<t){k.setEndPoint("StartToEnd",B)}else{k.setEndPoint("StartToStart",B)}k.setEndPoint("EndToEnd",r);k.select()}}}})(jQuery);(function(f){var o=function(s,r){return(s<<r)|(s>>>(32-r))};var a=function(v,s){var x,r,u,w,t;u=(v&2147483648);w=(s&2147483648);x=(v&1073741824);r=(s&1073741824);t=(v&1073741823)+(s&1073741823);if(x&r){return(t^2147483648^u^w)}if(x|r){if(t&1073741824){return(t^3221225472^u^w)}else{return(t^1073741824^u^w)}}else{return(t^u^w)}};var q=function(r,t,s){return(r&t)|((~r)&s)};var n=function(r,t,s){return(r&s)|(t&(~s))};var l=function(r,t,s){return(r^t^s)};var k=function(r,t,s){return(t^(r|(~s)))};var h=function(u,t,z,y,r,v,w){u=a(u,a(a(q(t,z,y),r),w));return a(o(u,v),t)};var d=function(u,t,z,y,r,v,w){u=a(u,a(a(n(t,z,y),r),w));return a(o(u,v),t)};var j=function(u,t,z,y,r,v,w){u=a(u,a(a(l(t,z,y),r),w));return a(o(u,v),t)};var e=function(u,t,z,y,r,v,w){u=a(u,a(a(k(t,z,y),r),w));return a(o(u,v),t)};var g=function(u){var y;var t=u.length;var s=t+8;var x=(s-(s%64))/64;var w=(x+1)*16;var z=Array(w-1);var r=0;var v=0;while(v<t){y=(v-(v%4))/4;r=(v%4)*8;z[y]=(z[y]|(u.charCodeAt(v)<<r));v++}y=(v-(v%4))/4;r=(v%4)*8;z[y]=z[y]|(128<<r);z[w-2]=t<<3;z[w-1]=t>>>29;return z};var c=function(u){var t="",r="",v,s;for(s=0;s<=3;s++){v=(u>>>(s*8))&255;r="0"+v.toString(16);t=t+r.substr(r.length-2,2)}return t};var m=function(s){s=s.replace(/\x0d\x0a/g,"\x0a");var r="";for(var u=0;u<s.length;u++){var t=s.charCodeAt(u);if(t<128){r+=String.fromCharCode(t)}else{if((t>127)&&(t<2048)){r+=String.fromCharCode((t>>6)|192);r+=String.fromCharCode((t&63)|128)}else{r+=String.fromCharCode((t>>12)|224);r+=String.fromCharCode(((t>>6)&63)|128);r+=String.fromCharCode((t&63)|128)}}}return r};f.extend({md5:function(r){var z=Array();var J,K,s,y,I,T,S,Q,N;var G=7,E=12,C=17,A=22;var R=5,O=9,M=14,L=20;var w=4,v=11,u=16,t=23;var H=6,F=10,D=15,B=21;r=m(r);z=g(r);T=1732584193;S=4023233417;Q=2562383102;N=271733878;for(J=0;J<z.length;J+=16){K=T;s=S;y=Q;I=N;T=h(T,S,Q,N,z[J+0],G,3614090360);N=h(N,T,S,Q,z[J+1],E,3905402710);Q=h(Q,N,T,S,z[J+2],C,606105819);S=h(S,Q,N,T,z[J+3],A,3250441966);T=h(T,S,Q,N,z[J+4],G,4118548399);N=h(N,T,S,Q,z[J+5],E,1200080426);Q=h(Q,N,T,S,z[J+6],C,2821735955);S=h(S,Q,N,T,z[J+7],A,4249261313);T=h(T,S,Q,N,z[J+8],G,1770035416);N=h(N,T,S,Q,z[J+9],E,2336552879);Q=h(Q,N,T,S,z[J+10],C,4294925233);S=h(S,Q,N,T,z[J+11],A,2304563134);T=h(T,S,Q,N,z[J+12],G,1804603682);N=h(N,T,S,Q,z[J+13],E,4254626195);Q=h(Q,N,T,S,z[J+14],C,2792965006);S=h(S,Q,N,T,z[J+15],A,1236535329);T=d(T,S,Q,N,z[J+1],R,4129170786);N=d(N,T,S,Q,z[J+6],O,3225465664);Q=d(Q,N,T,S,z[J+11],M,643717713);S=d(S,Q,N,T,z[J+0],L,3921069994);T=d(T,S,Q,N,z[J+5],R,3593408605);N=d(N,T,S,Q,z[J+10],O,38016083);Q=d(Q,N,T,S,z[J+15],M,3634488961);S=d(S,Q,N,T,z[J+4],L,3889429448);T=d(T,S,Q,N,z[J+9],R,568446438);N=d(N,T,S,Q,z[J+14],O,3275163606);Q=d(Q,N,T,S,z[J+3],M,4107603335);S=d(S,Q,N,T,z[J+8],L,1163531501);T=d(T,S,Q,N,z[J+13],R,2850285829);N=d(N,T,S,Q,z[J+2],O,4243563512);Q=d(Q,N,T,S,z[J+7],M,1735328473);S=d(S,Q,N,T,z[J+12],L,2368359562);T=j(T,S,Q,N,z[J+5],w,4294588738);N=j(N,T,S,Q,z[J+8],v,2272392833);Q=j(Q,N,T,S,z[J+11],u,1839030562);S=j(S,Q,N,T,z[J+14],t,4259657740);T=j(T,S,Q,N,z[J+1],w,2763975236);N=j(N,T,S,Q,z[J+4],v,1272893353);Q=j(Q,N,T,S,z[J+7],u,4139469664);S=j(S,Q,N,T,z[J+10],t,3200236656);T=j(T,S,Q,N,z[J+13],w,681279174);N=j(N,T,S,Q,z[J+0],v,3936430074);Q=j(Q,N,T,S,z[J+3],u,3572445317);S=j(S,Q,N,T,z[J+6],t,76029189);T=j(T,S,Q,N,z[J+9],w,3654602809);N=j(N,T,S,Q,z[J+12],v,3873151461);Q=j(Q,N,T,S,z[J+15],u,530742520);S=j(S,Q,N,T,z[J+2],t,3299628645);T=e(T,S,Q,N,z[J+0],H,4096336452);N=e(N,T,S,Q,z[J+7],F,1126891415);Q=e(Q,N,T,S,z[J+14],D,2878612391);S=e(S,Q,N,T,z[J+5],B,4237533241);T=e(T,S,Q,N,z[J+12],H,1700485571);N=e(N,T,S,Q,z[J+3],F,2399980690);Q=e(Q,N,T,S,z[J+10],D,4293915773);S=e(S,Q,N,T,z[J+1],B,2240044497);T=e(T,S,Q,N,z[J+8],H,1873313359);N=e(N,T,S,Q,z[J+15],F,4264355552);Q=e(Q,N,T,S,z[J+6],D,2734768916);S=e(S,Q,N,T,z[J+13],B,1309151649);T=e(T,S,Q,N,z[J+4],H,4149444226);N=e(N,T,S,Q,z[J+11],F,3174756917);Q=e(Q,N,T,S,z[J+2],D,718787259);S=e(S,Q,N,T,z[J+9],B,3951481745);T=a(T,K);S=a(S,s);Q=a(Q,y);N=a(N,I)}var P=c(T)+c(S)+c(Q)+c(N);return P.toLowerCase()}})})(jQuery);(function(h,d,k){var a=undefined;if(h.wigiiNcdEtp&&h.wigiiNcdEtp.options){a=h.wigiiNcdEtp.options}if(!a){a={}}if(!a.privateNcdEtpMembers){a.privateNcdEtpMembers={}}var c=function(n){a.privateNcdEtpMembers[n]=true};var f={};f.instantiationTime=Date.now();c("instantiationTime");f.ctxKey="WigiiNcdEtp_"+f.instantiationTime;c("ctxKey");f.version=function(){return"2.0"};if(!a.programOutput){a.programOutput="#programOutput"}var e=k().getHtmlEmitter(a.programOutput);f.html=e;c("html");var m=function(o){e.clearErrors();try{o();e.end()}catch(n){e.publishException(n)}};f.debug={};f.debug.initialize=function(){if(d("#programWatcherContainer").length==0){e.$().css("float","left").css("width","71%").after('<div id="programWatcherContainer"><div id="programWatcher"></div></div><div style="clear:both;"></div>')}d("#programWatcherContainer").show();return f.debug};f.debug.$=function(){return d("#programWatcherContainer")};var j={stockerDonnee:function(o,q,n){if(n===undefined){wigii().getRiseNcd().storeData(o,undefined,q)}else{wigii().getRiseNcd().storeData(o,q,n)}},obtenirDonnee:function(n){return wigii().getRiseNcd().getData(n)},creerEspaceStockage:function(n,o){return wigii().getRiseNcd().createDataStorage(n,o)},sysUsername:function(){return wigii().getRiseNcd().sysUsername()},rise:function(){return wigii().getRiseNcd()}};e.addModeler(function(n){n.impl.out=function(q,o){n.startSpan(o);n.put(q);n.endSpan();return n};n.impl.h1=function(q,o){n.startH1(o);n.put(q);n.endH1();return n};n.impl.p=function(o){n.startP(o);return n};n.impl.$p=function(){n.endP();return n};n.impl.b=function(o){n.startSpan("b");n.put(o);n.endSpan();return n};n.impl.i=function(o){n.startSpan("i");n.put(o);n.endSpan();return n};n.impl.u=function(o){n.startSpan("u");n.put(o);n.endSpan();return n};n.impl.a=function(o){n.put(k().getHtmlBuilder().putStartTag("a","href",o,"target","_blank","class",n.emittedClass()).put(o).putEndTag("a").html());return n};n.impl.color=function(r,q,o){n.startColor(r,q,o);return n};n.impl.$color=function(){n.endColor();return n};n.impl.bouton=function(q,r,o){n.putButton(q,r,o);return n};n.impl.input=function(o){return n.createTextArea(o)};n.impl.display=function(r,o,q){return n.createTextInput(q).color(r,o)};n.impl.insert=function(o){n.htmlBuilder().insert(o).emit();return n};n.impl.button=n.impl.bouton;n.out=n.impl.out;n.h1=n.impl.h1;n.p=n.impl.p;n.$p=n.impl.$p;n.b=n.impl.b;n.i=n.impl.i;n.u=n.impl.u;n.a=n.impl.a;n.color=n.impl.color;n.$color=n.impl.$color;n.bouton=n.impl.bouton;n.input=n.impl.input;n.display=n.impl.display;n.insert=n.impl.insert;n.button=n.impl.button});e.addModeler(function(n){n.context.gridInstance=undefined;n.impl.grille=function(q,o){if(q===undefined&&o===undefined){return n.context.gridInstance}if(n.context.gridInstance){d("#"+n.context.gridInstance.ctxKey).remove()}n.context.gridInstance=n.createGrid(q,o);n.context.gridInstance.cellule=n.impl.grille.cellule;n.context.gridInstance.couleur=n.impl.grille.couleur;n.context.gridInstance.texte=n.impl.grille.texte;n.context.gridInstance.onclick=n.impl.grille.onclick;n.context.gridInstance.nLignes=n.context.gridInstance.nRows;n.context.gridInstance.nColonnes=n.context.gridInstance.nCols;n.context.gridInstance.initializeCellForEtp=function(s){if(!s.context.etpReady){s.texte=s.text;s.couleur=s.color;s.gauche=function(){return n.context.gridInstance.initializeCellForEtp(s.left(true))};s.droite=function(){return n.context.gridInstance.initializeCellForEtp(s.right(true))};s.bas=function(){return n.context.gridInstance.initializeCellForEtp(s.down(true))};s.haut=function(){return n.context.gridInstance.initializeCellForEtp(s.up(true))};s.bouton=function(t,u){d("#"+s.id()).addClass("button");return s.text(t).click(u)};s.cellule=function(t,u){return n.impl.grille.cellule(t,u)};var r=s.offset;s.offset=function(t,u){return n.context.gridInstance.initializeCellForEtp(r(t,u))};s.espace={};s.context.etpReady=true}return s};return n.context.gridInstance};n.impl.grille.cellule=function(o,q){return n.context.gridInstance.initializeCellForEtp(n.context.gridInstance.cell(o-1,q-1))};n.impl.grille.couleur=function(q,r,o){if(o===undefined){return n.context.gridInstance.cell(q-1,r-1).color()}else{n.context.gridInstance.cell(q-1,r-1).color(o);return n.context.gridInstance}};n.impl.grille.texte=function(o,r,q){if(q===undefined){return n.context.gridInstance.cell(o-1,r-1).text()}else{n.context.gridInstance.cell(o-1,r-1).text(q);return n.context.gridInstance}};n.impl.grille.onclick=function(r){for(var q=0;q<n.context.gridInstance.nRows();q++){for(var o=0;o<n.context.gridInstance.nCols();o++){n.context.gridInstance.cell(q,o).click(function(s){if(f.programme.context){f.programme.context.html(n)}r(s.x()+1,s.y()+1)})}}return n.context.gridInstance};n.impl.grille.nLignes=function(){return n.context.gridInstance.nLignes()};n.impl.grille.nColonnes=function(){return n.context.gridInstance.nColonnes()};n.impl.grille.nRows=function(){return n.context.gridInstance.nRows()};n.impl.grille.nCols=function(){return n.context.gridInstance.nCols()};n.grille=n.impl.grille});var l={impl:{collection:{},instance:function(o){var n=this;n.index=o;n.list=[];n.lire=function(q){if(q-1<0||q-1>=n.list.length){throw k().createServiceException("L'index "+q+" est invalide, il doit être compris entre 1 et "+n.list.length,k().errorCodes.INVALID_ARGUMENT)}return n.list[q-1]};n.lirePremier=function(){return n.lire(1)};n.lireDernier=function(){return n.lire(n.taille())};n.remplacer=function(r,q){if(r-1<0||r-1>=n.list.length){throw k().createServiceException("L'index "+r+" est invalide, il doit être compris entre 1 et "+n.list.length,k().errorCodes.INVALID_ARGUMENT)}n.list[r-1]=q;return n};n.ajouter=function(q){n.list.push(q);return n};n.sortirDernier=function(){return n.list.pop()};n.taille=function(){return n.list.length};n.montrer=function(){f.debug.initialize().$().find("#programWatcher").html("<u>"+n.index+"</u> Taille: "+n.taille()+"<br/>"+JSON.stringify(n.list))};n.exporter=function(){return n.list};n.importer=function(q){if(q===undefined||q===null){return n}if(d.isArray(q)){n.list=q}else{n.list.push(q)}return n};n.vider=function(){n.list=[];return n};n.trier=function(q){n.list.sort(q);return n};n.read=n.lire;n.readFirst=n.lirePremier;n.readLast=n.lireDernier;n.replace=n.remplacer;n.add=n.ajouter;n.removeLast=n.sortirDernier;n.size=n.taille;n.show=n.montrer;n.exportContent=n.exporter;n.importContent=n.importer;n.empty=n.vider;n.sort=n.trier}},no:function(n){var o=l.impl.collection["P_"+n];if(!o){o=new (l.impl.instance)(n);l.impl.collection["P_"+n]=o}return o},reset:function(){l.impl.collection={}},lire:function(n){return l.no("default").lire(n)},lirePremier:function(){return l.no("default").lirePremier()},lireDernier:function(){return l.no("default").lireDernier()},remplacer:function(o,n){return l.no("default").remplacer(o,n)},ajouter:function(n){return l.no("default").ajouter(n)},sortirDernier:function(){return l.no("default").sortirDernier()},taille:function(){return l.no("default").taille()},montrer:function(){return l.no("default").montrer()},exporter:function(){return l.no("default").exporter()},importer:function(n){return l.no("default").importer(n)},vider:function(){return l.no("default").vider()},trier:function(n){return l.no("default").trier(n)}};var g={impl:{collection:{},instance:function(o){var n=this;n.index=o;n.context={currentFieldName:undefined,fieldIndex:0};n.fields={};n.Field=function(q,s,v,x,u,w,t){var r=this;r.context={};r.context.formulaire=q;r.context.nom=s;r.context.id="formulaire_"+q.index+"__"+s;r.context.display=undefined;r.context.label=v;r.context.changed=false;r.id=function(){return r.context.id};r.$=function(){return d("#"+r.context.id)};r.nom=function(){return r.context.nom};r.input=function(){return r.context.display};r.valeur=function(y){if(y===undefined){return r.context.display.text()}else{r.context.display.text(y);r.context.changed=false;return r}};r.label=function(y){if(y===undefined){return r.context.label}else{r.context.label=y;d("#"+r.context.id+" div.etp-label span:first-child").html(y);return r}};r.label.couleur=function(y){if(y===undefined){return d("#"+r.context.id+" div.etp-label span:first-child").css("color")}else{d("#"+r.context.id+" div.etp-label span:first-child").css("color",y);return r}};r.couleur=function(y){if(y===undefined){return d("#"+r.context.id).css("background-color")}else{d("#"+r.context.id).css("background-color",y);return r}};r.vider=function(){r.context.display.text("");return r};r.focus=function(){d("#"+r.context.display.ctxKey).focus();r.context.formulaire.context.currentFieldName=r.context.nom;return r};r.disabled=function(y){if(y===undefined){return d("#"+r.context.display.ctxKey).prop("disabled")}else{d("#"+r.context.display.ctxKey).prop("disabled",y);return r}};r.readonly=function(y){if(y===undefined){return d("#"+r.context.display.ctxKey).prop("readonly")}else{d("#"+r.context.display.ctxKey).prop("readonly",y);return r}};r.changed=function(y){if(y===undefined){return r.context.changed}else{r.context.changed=y;return r}};r.champ=function(y){return r.context.formulaire.champ(y)};r.name=r.nom;r.value=r.valeur;r.label.color=r.label.couleur;r.color=r.couleur;r.empty=r.vider;r.field=r.champ;f.programme.currentDiv().putHtml(k().getHtmlBuilder().putStartTag("div","id",r.context.id,"class","etp-field "+e.emittedClass()).putStartTag("div","class","etp-label "+e.emittedClass()).putStartTag("span","class",e.emittedClass()).put(r.context.label).putEndTag("span").putEndTag("div").putStartTag("div","class","etp-value "+e.emittedClass()).putEndTag("div").putEndTag("div").html());q.context.fieldIndex++;if(w){switch(w){case"TextArea":r.context.display=k().getHtmlEmitter("#"+r.context.id+" div.etp-value").createTextArea(undefined,q.context.fieldIndex).color(u,x);break;case"PasswordInput":r.context.display=k().getHtmlEmitter("#"+r.context.id+" div.etp-value").createPasswordInput(undefined,q.context.fieldIndex).color(u,x);break;case"Empty":r.context.display=undefined;break;default:throw k().createServiceException("Le type de champ '"+w+"' n'est pas supporté.",k().errorCodes.INVALID_ARGUMENT)}}else{r.context.display=k().getHtmlEmitter("#"+r.context.id+" div.etp-value").createTextInput(undefined,q.context.fieldIndex).color(u,x)}if(r.context.display){r.context.display.id=function(){return r.context.display.ctxKey};r.context.display.$=function(){return d("#"+r.context.display.ctxKey)};r.context.display.couleur=r.context.display.color;r.context.display.onInput(function(z,y){z.context.text=y;r.context.changed=true});r.context.display.$().click(function(){r.context.formulaire.context.currentFieldName=r.context.nom})}return r};n.creerChamp=function(q,s,t,r){var u=n.fields[q];if(u){throw k().createServiceException("Le champ "+q+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}n.fields[q]=new n.Field(n,q,s,t,r);return n};n.creerChampTexte=function(q,s,t,r){var u=n.fields[q];if(u){throw k().createServiceException("Le champ "+q+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}n.fields[q]=new n.Field(n,q,s,t,r,"TextArea");return n};n.creerChampPassword=function(q,s,t,r){var u=n.fields[q];if(u){throw k().createServiceException("Le champ "+q+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}n.fields[q]=new n.Field(n,q,s,t,r,"PasswordInput");return n};n.creerChampCustom=function(u,x,q,s,z){var w=n.fields[u];if(w){throw k().createServiceException("Le champ "+u+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}n.fields[u]=new n.Field(n,u,x,s,z,"Empty");var v;if(arguments.length>5){v=Array.prototype.slice.call(arguments,5)}else{v=[]}var t=n.fields[u].$().find("div.etp-value").wncd("html");if(d.isFunction(q)){var y=wncd.currentDiv();wncd.programme.context.html(t);var r=q.apply(null,v);if(r!==undefined){t.putHtml(r)}wncd.programme.context.html(y)}else{t.putHtml(q)}return n};n.champ=function(q){var r=n.fields[q];if(!r){throw k().createServiceException("Le champ "+q+" n'existe pas dans le formulaire.",k().errorCodes.INVALID_ARGUMENT)}return r};n.champExiste=function(q){var r=n.fields[q];return(r?true:false)};n.champCourant=function(q){if(q!==undefined){n.context.currentFieldName=q}if(!n.context.currentFieldName){throw k().createServiceException("Aucun champ n'est actuellement sélectionné dans le formulaire. Cliquez sur un champ.",k().errorCodes.INVALID_STATE)}return n.champ(n.context.currentFieldName)};n.vider=function(){for(var q in n.fields){n.fields[q].vider()}return n};n.supprimer=function(){g.remove(n.index)};n.createField=n.creerChamp;n.createTextField=n.creerChampTexte;n.createPasswordField=n.creerChampPassword;n.createCustomField=n.creerChampCustom;n.field=n.champ;n.fieldExist=n.champExiste;n.currentField=n.champCourant;n.empty=n.vider;n.remove=n.supprimer;n.reset=function(){return g.reset(n.index)}}},no:function(n){var o=g.impl.collection["F_"+n];if(!o){o=new (g.impl.instance)(n);g.impl.collection["F_"+n]=o}return o},remove:function(n){var o=g.impl.collection["F_"+n];if(o){g.impl.collection["F_"+n]=null;for(fieldName in o.fields){var q=o.fields[fieldName];d("#"+q.id()).remove();q.context.formulaire=undefined;q.context.display=undefined;q.context=undefined}}},creerChamp:function(n,q,r,o){return g.no("default").creerChamp(n,q,r,o)},creerChampTexte:function(n,q,r,o){return g.no("default").creerChampTexte(n,q,r,o)},creerChampPassword:function(n,q,r,o){return g.no("default").creerChampPassword(n,q,r,o)},creerChampCustom:function(n,q,r,s,o){return g.no("default").creerChampCustom(n,q,r,s,o)},champ:function(n){return g.no("default").champ(n)},champExiste:function(n){return g.no("default").champExiste(n)},champCourant:function(n){return g.no("default").champCourant(n)},vider:function(){return g.no("default").vider()},supprimer:function(){return g.no("default").supprimer()},reset:function(n){if(n===undefined){n="default"}g.no(n).supprimer();return g.no(n)}};f.programme=m;f.out=e.out;f.h1=e.h1;f.p=e.p;f.$p=e.$p;f.b=e.b;f.i=e.i;f.u=e.u;f.a=e.a;f.color=e.color;f.$color=e.$color;f.bouton=e.bouton;f.input=e.input;f.display=e.display;f.grille=e.grille;f.panier=l;f.formulaire=g;f.serveur=j;f.program=f.programme;f.button=f.bouton;f.grid=f.grille;f.basket=f.panier;f.basket.read=f.panier.lire;f.basket.readFirst=f.panier.lirePremier;f.basket.readLast=f.panier.lireDernier;f.basket.replace=f.panier.remplacer;f.basket.add=f.panier.ajouter;f.basket.removeLast=f.panier.sortirDernier;f.basket.size=f.panier.taille;f.basket.show=f.panier.montrer;f.basket.exportContent=f.panier.exporter;f.basket.importContent=f.panier.importer;f.basket.empty=f.panier.vider;f.basket.sort=f.panier.trier;f.form=f.formulaire;f.form.createField=f.formulaire.creerChamp;f.form.createTextField=f.formulaire.creerChampTexte;f.form.createPasswordField=f.formulaire.creerChampPassword;f.form.createCustomField=f.formulaire.creerChampCustom;f.form.field=f.formulaire.champ;f.form.currentField=f.formulaire.champCourant;f.form.empty=f.formulaire.vider;f.server=f.serveur;f.server.getData=f.serveur.obtenirDonnee;f.server.storeData=f.serveur.stockerDonnee;if(!h.wigiiNcdEtp||!h.wigiiNcdEtp.version||h.wigiiNcdEtp.version()<f.version()){h.wigiiNcdEtp=f;if(a.publishNcdEtpToWncd===undefined){a.publishNcdEtpToWncd=function(n,o){for(var q in n){if(!a.privateNcdEtpMembers[q]){o[q]=n[q]}}o.html=n.html.clone}}if(!h.wncd){h.wncd={}}if(a.publishNcdEtpToWncd){a.publishNcdEtpToWncd(f,h.wncd)}if(a.publishNcdEtpToWindow===undefined){a.publishNcdEtpToWindow=function(n,o){for(var q in n){if(!a.privateNcdEtpMembers[q]){o[q]=n[q]}}}}if(a.publishNcdEtpToWindow){a.publishNcdEtpToWindow(f,h)}}if(a.ncdEtpReady===undefined){a.ncdEtpReady=function(n){var o=d("#footer");if(o.length>0){o.append("<span><i>&nbsp;Wigii NCD core v."+n.version()+" loaded</i></span>")}}}if(a.ncdEtpReady){a.ncdEtpReady(f)}f.options=a;c("options")})(window,jQuery,wigiiNcd);(function(o,k,E,f){var G=f.options;var j=function(J){G.privateNcdEtpMembers[J]=true};var v=f.html;var m=function(){var K=Array.prototype.slice.call(arguments);var M=F();var L=undefined;M.pause=function(){if(!M.isPaused){M.isPaused=true}};M.resume=function(O){L=O;if(M.isPaused){M.isPaused=false;M.argsI++;try{while(M.argsI<K.length){if(k.isFunction(K[M.argsI])){L=K[M.argsI](M);if(k.isFunction(L)){L=L(M)}}else{throw E().createServiceException("programme instruction number "+M.argsI+" is not a function.",E().errorCodes.INVALID_ARGUMENT)}if(M.isPaused){return}M.argsI++}M.html().end()}catch(N){M.html().publishException(N)}}};try{M.html().clearErrors();while(M.argsI<K.length){if(k.isFunction(K[M.argsI])){L=K[M.argsI](M);if(k.isFunction(L)){L=L(M)}}else{throw E().createServiceException("programme instruction number "+M.argsI+" is not a function.",E().errorCodes.INVALID_ARGUMENT)}if(M.isPaused){return}M.argsI++}M.html().end()}catch(J){M.html().publishException(J)}};f.Runtime=function(J,L){var K=this;K.className="Runtime";K.instantiationTime=Date.now();K.ctxKey=f.ctxKey+"_"+K.className+K.instantiationTime;K.options=L||{};K.context={html:J};K.impl={};K.program=function(){K.context.currentDiv=wncd.currentDiv();wncd.program.context.html(K.context.html);var N=Array.prototype.slice.call(arguments);var P=F();var O=undefined;P.pause=function(){if(!P.isPaused){P.isPaused=true}};P.resume=function(R){O=R;if(P.isPaused){P.isPaused=false;P.argsI++;try{while(P.argsI<N.length){if(k.isFunction(N[P.argsI])){O=N[P.argsI](P);if(k.isFunction(O)){O=O(P)}}else{throw E().createServiceException("programme instruction number "+P.argsI+" is not a function.",E().errorCodes.INVALID_ARGUMENT)}if(P.isPaused){return}P.argsI++}P.html().end()}catch(Q){P.html().publishException(Q)}wncd.program.context.html(K.context.currentDiv)}};try{P.html().clearErrors();while(P.argsI<N.length){if(k.isFunction(N[P.argsI])){O=N[P.argsI](P);if(k.isFunction(O)){O=O(P)}}else{throw E().createServiceException("programme instruction number "+P.argsI+" is not a function.",E().errorCodes.INVALID_ARGUMENT)}if(P.isPaused){return}P.argsI++}P.html().end()}catch(M){P.html().publishException(M)}wncd.program.context.html(K.context.currentDiv)};K.programme=K.program};f.createRuntime=function(J,K){return new f.Runtime(J,K)};E().getJQueryService().run=function(L,J){var K=undefined;if(L&&L.length==1){K=f.createRuntime(wncd.html(L),J)}else{if(L&&L.length>1){throw wncd.createServiceException("Wigii NCD run selector can only be activated on a JQuery collection containing one element and not "+L.length,wncd.errorCodes.INVALID_ARGUMENT)}}return(!K?{$:L}:K)};var D=function(){var J=Array.prototype.slice.call(arguments);var K=function(){m.apply(null,J)};K.toFxString=function(){var L="sousProgramme(";for(var M=0;M<J.length;M++){if(M>0){L+=","}L+=E().obj2FxString(J[M])}L+=")";return L};return K};var F=function(){var J={argsI:0,isPaused:false,impl:{}};J.html=function(K){if(K===undefined){return J.impl.html||f.html}else{J.impl.html=K;return J}};J.html(m.currentDiv());return J};var s=function(M,L,J){m.context.fxCtx=L;var K=M.apply(null,J);m.context.fxCtx=undefined;return K};var h=function(K){var J;if(arguments.length>1){J=Array.prototype.slice.call(arguments,1)}else{J=[]}return function(N){var L=[];for(var M=0;M<J.length;M++){if(k.isFunction(J[M])){L[M]=J[M](N)}else{L[M]=J[M]}}return s(K,N,L)}};var w=function(M,L){var J;if(arguments.length>2){J=Array.prototype.slice.call(arguments,2)}else{J=[]}var K=function(P){var N=[];for(var O=0;O<J.length;O++){if(k.isFunction(J[O])){N[O]=J[O](P)}else{N[O]=J[O]}}return s(L,P,N)};K.toFxString=function(){var N=M+"(";for(var O=0;O<J.length;O++){if(O>0){N+=","}N+=E().obj2FxString(J[O])}N+=")";return N};return K};var I=function(M,L){var J;if(arguments.length>2){J=Array.prototype.slice.call(arguments,2)}else{J=[]}var K=function(Q){var N=[];for(var O=0;O<J.length;O++){if(k.isFunction(J[O])){N[O]=J[O](Q)}else{N[O]=J[O]}}var P=L(Q);return s(P,Q,N)};K.toFxString=function(){var N=M+"(";for(var O=0;O<J.length;O++){if(O>0){N+=","}N+=E().obj2FxString(J[O])}N+=")";return N};return K};var B=function(){var J=[];var M=F();var K={addFx:function(N){J.push(N)},toFx:function(){return function(O){M.html(O.html());var N=undefined;M.pause=function(){if(!M.isPaused){M.isPaused=true;if(O){O.pause()}}};M.resume=function(P){N=P;if(M.isPaused){M.isPaused=false;M.argsI++;while(M.argsI<J.length){if(k.isFunction(J[M.argsI])){N=J[M.argsI](M);if(k.isFunction(N)){N=N(M)}}else{N=J[M.argsI]}if(M.isPaused){return}M.argsI++}M.argsI=0;if(O){N=O.resume(N)}}return N};while(M.argsI<J.length){if(k.isFunction(J[M.argsI])){N=J[M.argsI](M);if(k.isFunction(N)){N=N(M)}}else{N=J[M.argsI]}if(M.isPaused){return}M.argsI++}M.argsI=0;return N}}};if(arguments.length>0){J=Array.prototype.slice.call(arguments);var L=K.toFx();L.toFxString=function(){var N="ctlSeq(";for(var O=0;O<J.length;O++){if(O>0){N+=","}N+=E().obj2FxString(J[O])}N+=")";return N};return L}else{return K}};var u=function(K){var J=function(L){return s(K,L,undefined)};J.toFxString=function(){var L="scripte(";L+=E().obj2FxString(K);L+=")";return L};return J};var d=function(L,N,J){var M=F();M.stepI=1;M.isSpanFunction=k.isFunction(L);if(!k.isFunction(N)){throw E().createServiceException("generator should be a function.",E().errorCodes.INVALID_ARGUMENT)}var K=function(R){M.html(R.html());var Q=undefined;M.pause=function(){if(!M.isPaused){M.isPaused=true;if(R){R.pause()}}};M.resume=function(U){Q=U;if(M.isPaused){M.isPaused=false;M.stepI++;var S=(M.isSpanFunction?L(M.stepI,J):M.stepI<=L);while(S){var T=N(M.stepI,J);if(k.isFunction(T)){Q=T(M)}else{Q=T}if(M.isPaused){return}M.stepI++;S=(M.isSpanFunction?L(M.stepI,J):M.stepI<=L)}M.stepI=1;if(R){Q=R.resume(Q)}}return Q};var O=(M.isSpanFunction?L(M.stepI,J):M.stepI<=L);while(O){var P=N(M.stepI,J);if(k.isFunction(P)){Q=P(M)}else{Q=P}if(M.isPaused){return}M.stepI++;O=(M.isSpanFunction?L(M.stepI,J):M.stepI<=L)}M.stepI=1;return Q};K.toFxString=function(){var O="ctlGen(";O+=E().obj2FxString(L);O+=",";O+=E().obj2FxString(N);O+=",";if(J===undefined){O+="undefined"}else{O+=E().obj2FxString(J)}O+=")";return O};return K};var e={};var y={};var r=function(N){if(!N){throw E().createServiceException("Catalog ID cannot be null",E().errorCodes.INVALID_ARGUMENT)}var K=e[N];if(!K){K=m.panier.no(f.ctxKey+"_"+N);K.importer(f.serveur.obtenirDonnee(N));var M=K.taille();if(M>0){for(var J=1;J<=M;J++){var L=K.lire(J);if(L&&L.info){y[N+"_"+L.info.id]=L}}}e[N]=K}return K};var A=function(L,K){var J=y[L+"_"+K];if(!J){if(r(L).taille()>0){J=y[L+"_"+K]}}return J};var C=function(M,K,O,J){var L=D(p(),out("Du code publique."),$p(),p(),out("Définir le catalogue ID et le code ID pour le charger."),$p());var N={info:undefined};if(K&&O){N=A(K,O);if(!N){throw E().createServiceException("No source code found in catalog '"+K+"' with ID '"+O+"'",E().errorCodes.INVALID_ARGUMENT)}L=E().fxString2obj(k.base64Decode(N.program))}return{label:M,cssClass:J,program:L,info:N.info}};var q=function(R,O,K,T){try{var J={label:R,cssClass:T,program:O,info:{}};if(K){J.info.author=K.author;J.info.description=K.description;if(K.key){J.info.key=k.md5(K.key)}if(K.publish){var Q=Date.now();var M={info:J.info,program:k.base64Encode(E().obj2FxString(O))};var N=false;var P=false;if(K.id){var L=A(K.catalog,K.id);if(!L){J.info.id=K.id;J.info.catalog=K.catalog;J.info.date=Q;J.info.modificationDate=Q;r(J.info.catalog).ajouter(M);y[J.info.catalog+"_"+J.info.id]=M;N=true}else{if(L.info.key&&L.info.key!=M.info.key){throw E().createServiceException("Invalid modification key. No rights to modify code in catalog '"+K.catalog+"' with ID '"+K.id+"'",E().errorCodes.FORBIDDEN)}N=E().updateObjIfChanged(L.info,M.info).field("author").field("description").set("modificationDate",Q).hasChanges();N=E().updateObjIfChanged(L,M).field("program").set("info",Q,"modificationDate").hasChanges()|N;if(N){M=L}}}else{J.info.id=Q+"_"+M.program.substr(3,8);J.info.catalog=K.catalog;J.info.date=Q;J.info.modificationDate=Q;r(J.info.catalog).ajouter(M);y[J.info.catalog+"_"+J.info.id]=M;N=true;P=true}if(N){M.id=M.info.id;f.serveur.stockerDonnee(K.catalog,"id",M)}if(P){J.program=D(p(),out('Le code source "'),i(K.description),out('" a été publié dans le catalogue '+K.catalog+" sous l'ID: "),b(M.id),$p(),p(),color("orange"),out("Ajoutez l'ID dans les infos de publications du code source avant de recharger une nouvelle fois la page."),$color(),$p())}}}}catch(S){m.html().publishException(S)}return J};var c=function(){var O=Date.now();var L=Array.prototype.slice.call(arguments);var K=v.div("menu"+O);var P=v.div("codeOutput"+O);var N={};N.modules=[];var J=function(Q){Q.menu=N;N.modules.push(Q);K.button(Q.label,function(){P.reset();m.context.codeSource=Q;m.context.html(P);Q.program();m.context.html(v)},Q.cssClass)};for(var M=0;M<L.length;M++){J(L[M])}};var g=function(K,M){var L=q(undefined,K,M);try{L.program()}catch(J){m.html().publishException(J)}};var t=function(K,M){try{var L=C(undefined,K,M);L.program()}catch(J){m.html().publishException(J)}};f.CodeSourceEditor=function(L,K){var J=this;J.className="CodeSourceEditor";J.instantiationTime=Date.now();J.ctxKey=f.ctxKey+"_"+J.className+J.instantiationTime;J.options=K||{};J.context={};J.impl={};if(!J.options.testBtnLabel){J.options.testBtnLabel="Test"}if(!J.options.programOutput){J.options.programOutput=wncd.currentDiv();if(J.options.resetOutput===undefined){J.options.resetOutput=false}}else{if(J.options.programOutput==="above"||J.options.programOutput==="below"||J.options.programOutput==="between"){if(J.options.resetOutput===undefined){J.options.resetOutput=true}}else{if(k.type(J.options.programOutput)==="string"||J.options.programOutput.className!="HtmlEmitter"){J.options.programOutput=wncd.html(J.options.programOutput);if(J.options.resetOutput===undefined){J.options.resetOutput=true}}else{if(J.options.resetOutput===undefined){J.options.resetOutput=true}}}}J.context.codeScript=u(L);J.context.srcCode=E().obj2FxString(J.context.codeScript);J.impl.runCode=function(M){var N=m.currentDiv();m.context.html(J.options.programOutput);if(J.options.resetOutput){J.options.programOutput.reset()}M();m.context.html(N)};if(J.options.programOutput==="above"){J.options.programOutput=m.currentDiv().div(J.ctxKey+"_out")}J.context.textArea=m.currentDiv().createTextArea(J.options.textAreaClass);J.context.textArea.text(J.context.srcCode).onInput(function(N,M){N.text(M)}).$().tabby();if(J.options.programOutput==="between"){J.options.programOutput=m.currentDiv().div(J.ctxKey+"_out")}m.currentDiv().button(J.options.testBtnLabel,function(){var N=J.context.textArea.text();var M=E().fxString2obj(N);J.impl.runCode(M);J.context.codeScript=M;if(J.options.afterTest){J.options.afterTest(J)}},J.options.testBtnClass);if(J.options.programOutput==="below"){J.options.programOutput=m.currentDiv().div(J.ctxKey+"_out")}if(J.options.runOnLoad){J.impl.runCode(J.context.codeScript);if(J.options.afterTest){J.options.afterTest(J)}}};f.createCodeSourceEditor=function(K,J){return new f.CodeSourceEditor(K,J)};var n=function(L,J){var K=function(M){return f.createCodeSourceEditor(L,J)};K.toFxString=function(){var M="exemple(";M+=E().obj2FxString(L);if(J){M+=",";M+=E().obj2FxString(J)}M+=")";return M};return K};var l=function(J){var K=function(L){if(L){L.pause();setTimeout(function(){try{L.resume()}catch(M){L.html().publishException(M)}},1000*J)}};K.toFxString=function(){var L="pause(";L+=E().obj2FxString(J);L+=")";return L};return K};var a=function(L,K,J){var M=function(N){N.html().button(L,function(){if(k.isFunction(K)){s(K,N,undefined)}if(N){N.resume()}},J);if(N){N.pause()}};M.toFxString=function(){var N="boutonDePause(";N+=E().obj2FxString(L);if(K){N+=",";N+=E().obj2FxString(K)}if(J){if(!K){N+=",undefined"}N+=",";N+=E().obj2FxString(K)}N+=")";return N};return M};var x=function(K,L,J){return I("bouton",function(M){return M.html().button},K,function(){return L},J)};v.addModeler(function(J){J.tortue={impl:{collection:{},instance:function(L){var K=this;K.context={tortue:undefined,key:L};K.impl={};K.impl.initialize=function(M){if(!J.context.gridInstance){throw E().createServiceException("Aucune grille n'existe. Appelez d'abord la fonction grille(nLignes,nCols).",E().errorCodes.INVALID_STATE)}if(!K.context.tortue||M){K.context.tortue=new (E().GridTurtle)(J.context.gridInstance,undefined,M)}return K.context.tortue};K.impl.start=function(M,P,O,N){K.impl.initialize(N).start(M-1,P-1,O)};K.impl.avance=function(){K.impl.initialize().moveForward()};K.impl.avanceDiagGauche=function(){K.impl.initialize().moveForwardAndLeft()};K.impl.avanceDiagDroite=function(){K.impl.initialize().moveForwardAndRight()};K.impl.demiTour=function(){K.impl.initialize().turnBack()};K.impl.tourneAGauche=function(){K.impl.initialize().turnLeft()};K.impl.tourneADroite=function(){K.impl.initialize().turnRight()};K.start=function(M,P,O,N){return h(K.impl.start,M,P,O,N)};K.avance=function(){return B(l(0.4),h(K.impl.avance))};K.avanceDiagGauche=function(){return B(l(0.4),h(K.impl.avanceDiagGauche))};K.avanceDiagDroite=function(){return B(l(0.4),h(K.impl.avanceDiagDroite))};K.demiTour=function(){return B(l(0.4),h(K.impl.demiTour))};K.tourneAGauche=function(){return B(l(0.4),h(K.impl.tourneAGauche))};K.tourneADroite=function(){return B(l(0.4),h(K.impl.tourneADroite))};K.marche=function(N,M){if(!M){M=function(O,P){return P.avance()}}else{if(!k.isFunction(M)){throw E().createServiceException("plan doit être une fonction.",E().errorCodes.INVALID_ARGUMENT)}}return d(N,M,K.chainable(true))};K.celluleCourante=function(){if(K.context.tortue){return K.context.tortue.grid().initializeCellForEtp(K.context.tortue.currentCell())}};K.cellule=function(M,N){if(K.context.tortue){return K.context.tortue.grid().initializeCellForEtp(K.context.tortue.cell(M,N))}};K.memoire=function(){if(K.context.tortue){return K.context.tortue.context}};K.chainable=function(P){var M=B();var N=K;M.addFx(function(Q){Q.returnValue=N;return Q.returnValue});var O=function(R){var Q=M.toFx()(R);if(P){M=B()}return Q};O.start=function(Q,T,S,R){M.addFx(N.start(Q,T,S,R));return O},O.avance=function(){M.addFx(N.avance());return O},O.avanceDiagGauche=function(){M.addFx(N.avanceDiagGauche());return O},O.avanceDiagDroite=function(){M.addFx(N.avanceDiagDroite());return O},O.demiTour=function(){M.addFx(N.demiTour());return O},O.tourneAGauche=function(){M.addFx(N.tourneAGauche());return O},O.tourneADroite=function(){M.addFx(N.tourneADroite());return O};O.pause=function(Q){M.addFx(l(Q));return O};O.marche=function(R,Q){M.addFx(N.marche(R,Q));return O};O.celluleCourante=function(){return N.celluleCourante()};O.cellule=function(Q,R){return N.cellule(Q,R)};O.memoire=function(){return N.memoire()};return O}}},no:function(L){var K=J.tortue.impl.collection["T_"+L];if(!K){K=new (J.tortue.impl.instance)(L);J.tortue.impl.collection["T_"+L]=K}return K.chainable()},reset:function(){J.tortue.impl.collection={}},start:function(K,N,M,L){return J.tortue.no("default").start(K,N,M,L||"blue")},avance:function(){return J.tortue.no("default").avance()},avanceDiagGauche:function(){return J.tortue.no("default").avanceDiagGauche()},avanceDiagDroite:function(){return J.tortue.no("default").avanceDiagDroite()},demiTour:function(){return J.tortue.no("default").demiTour()},tourneAGauche:function(){return J.tortue.no("default").tourneAGauche()},tourneADroite:function(){return J.tortue.no("default").tourneADroite()},pause:function(K){return J.tortue.no("default").pause(K)},marche:function(L,K){return J.tortue.no("default").marche(L,K)},celluleCourante:function(){return J.tortue.no("default").celluleCourante()},cellule:function(K,L){return J.tortue.no("default").cellule(K,L)},memoire:function(){return J.tortue.no("default").memoire()}}});var z={no:function(J){return m.currentDiv().tortue.no(J)},reset:function(){m.currentDiv().tortue.reset()},start:function(J,M,L,K){return z.no("default").start(J,M,L,K||"blue")},avance:function(){return z.no("default").avance()},avanceDiagGauche:function(){return z.no("default").avanceDiagGauche()},avanceDiagDroite:function(){return z.no("default").avanceDiagDroite()},demiTour:function(){return z.no("default").demiTour()},tourneAGauche:function(){return z.no("default").tourneAGauche()},tourneADroite:function(){return z.no("default").tourneADroite()},pause:function(J){return z.no("default").pause(J)},marche:function(K,J){return z.no("default").marche(K,J)},celluleCourante:function(){return z.no("default").celluleCourante()},cellule:function(J,K){return z.no("default").cellule(J,K)},memoire:function(){return z.no("default").memoire()}};var H=function(K,J){return w("grille",function(L,M){m.currentDiv().tortue.reset();m.currentDiv().grille(L,M)},K,J)};H.cellule=function(J,M){var K=B();K.addFx(function(N){N.returnValue=N.html().grille.cellule(J,M);return N.returnValue});var L=function(N){return K.toFx()(N)};L.couleur=function(N){K.addFx(function(O){O.returnValue=O.returnValue.couleur(N);return O.returnValue});return L};L.texte=function(N){K.addFx(function(O){O.returnValue=O.returnValue.texte(N);return O.returnValue});return L};L.pause=function(N){K.addFx(l(N));return L};L.bouton=function(N,O){K.addFx(function(P){P.returnValue=P.returnValue.bouton(N,O);return P.returnValue});return L};L.gauche=function(){K.addFx(function(N){N.returnValue=N.returnValue.gauche();return N.returnValue});return L};L.droite=function(){K.addFx(function(N){N.returnValue=N.returnValue.droite();return N.returnValue});return L};L.bas=function(){K.addFx(function(N){N.returnValue=N.returnValue.bas();return N.returnValue});return L};L.haut=function(){K.addFx(function(N){N.returnValue=N.returnValue.haut();return N.returnValue});return L};L.cellule=function(N,O){K.addFx(function(P){P.returnValue=P.returnValue.cellule(N,O);return P.returnValue});return L};L.offset=function(N,O){K.addFx(function(P){P.returnValue=P.returnValue.offset(N,O);return P.returnValue});return L};return L};H.couleur=function(J,L,K){return I("grille.couleur",function(M){return M.html().grille.couleur},J,L,K)};H.texte=function(K,L,J){return I("grille.texte",function(M){return M.html().grille.texte},K,L,J)};H.onclick=function(J){return I("grille.onclick",function(K){return K.html().grille.onclick},function(){return J})};H.fonctionSurClique=H.onclick;f.out=function(K,J){return I("out",function(L){return L.html().out},K,J)};f.h1=function(K,J){return I("h1",function(L){return L.html().h1},K,J)};f.p=function(J){return I("p",function(K){return K.html().p},J)};f.$p=function(){return I("$p",function(J){return J.html().$p})};f.b=function(J){return I("b",function(K){return K.html().b},J)};f.i=function(J){return I("i",function(K){return K.html().i},J)};f.u=function(J){return I("u",function(K){return K.html().u},J)};f.a=function(J){return I("a",function(K){return K.html().a},J)};f.color=function(L,K,J){return I("color",function(M){return M.html().color},L,K,J)};f.$color=function(){return I("$color",function(J){return J.html().$color})};v.addModeler(function(J){J.layout=function(O){var L;if(arguments.length>1){L=Array.prototype.slice.call(arguments,1)}else{L=[]}var M={};M.x=function(R,Q,P){if(P.h&&!Q){M.h(R,P.h,P)}else{if(P.v&&!Q){M.v(R,P.v,P)}else{R.html().htmlBuilder().tag("div","id",P.id,"class",P.name+(P.cssClass?" "+P.cssClass:""),"style","float:left;width:"+P.width+"%;height:"+P.height+"%;").insert(Q[0]).$tag("div").emit()}}};M.x1=M.x;M.x2=M.x;M.x3=M.x;M.x4=M.x;M.x5=M.x;M.x6=M.x;M.x7=M.x;M.x8=M.x;M.x9=M.x;M.x10=M.x;M.weightOf=function(P){if(P&&P.startsWith("x")){return Number(P.substr(1))}else{return 0}};M.h=function(V,T,Y){var S=V.html().htmlBuilder();var P=Y.width;if(P){P=P+"%"}else{P=Y.cssWidth}var X=Y.height;if(X){X=X+"%"}else{X=Y.cssHeight}var R=0;var U=0;for(var Q=0;Q<T.length;Q++){R+=T[Q].options.weight}R=100/R;S.tag("div","id",Y.id,"class","h"+(Y.cssClass?" "+Y.cssClass:""),"style","float:left;width:"+P+";height:"+X+";");for(var Q=0;Q<T.length;Q++){var W=T[Q];if(Q<T.length-1){W.options.width=Math.floor(W.options.weight*R)}else{W.options.width=100-U}U+=W.options.width;W.options.height=100;S.insert(function(Z){Z(wncd.createFxContext())},W)}S.$tag("div").emit()};M.v=function(V,T,Y){var S=V.html().htmlBuilder();var P=Y.width;if(P){P=P+"%"}else{P=Y.cssWidth}var X=Y.height;if(X){X=X+"%"}else{X=Y.cssHeight}var R=0;var U=0;for(var Q=0;Q<T.length;Q++){R+=T[Q].options.weight}R=100/R;S.tag("div","id",Y.id,"class","v"+(Y.cssClass?" "+Y.cssClass:""),"style","float:left;width:"+P+";height:"+X+";");for(var Q=0;Q<T.length;Q++){var W=T[Q];W.options.width=100;if(Q<T.length-1){W.options.height=Math.floor(W.options.weight*R)}else{W.options.height=100-U}U+=W.options.height;S.insert(function(Z){Z(wncd.createFxContext())},W)}S.$tag("div").emit()};M.fx=function(R,Q,P){P={name:R,id:"",cssClass:"",weight:M.weightOf(R),h:(P?P.h:undefined),v:(P?P.v:undefined)};var S=function(T){return M[R](T,Q,P)};S.options=P;S.id=function(T){P.id=T;return S};S.cssClass=function(T){P.cssClass=T;return S};if(!M.weightOf(R)){S.height=function(T){P.cssHeight=T;return S};S.width=function(T){P.cssWidth=T;return S}}S.toFxString=function(){var U=R;var T=Q;if(P.h){U+=".h";T=P.h}else{if(P.v){U+=".v";T=P.v}}U+="(";for(var V=0;V<T.length;V++){if(V>0){U+=","}U+=wncd.obj2FxString(T[V])}U+=")";if(P.id){U+='.id("'+P.id+'")'}if(P.cssClass){U+='.cssClass("'+P.cssClass+'")'}if(R=="h"||R=="v"){if(P.cssWidth){U+='.width("'+P.cssWidth+'")'}if(P.cssHeight){U+='.height("'+P.cssHeight+'")'}}return U};return S};M.hFx=function(){return M.fx("h",Array.prototype.slice.call(arguments))};M.vFx=function(){return M.fx("v",Array.prototype.slice.call(arguments))};M.xFx=function(Q){var R=function(){return M.fx(Q,Array.prototype.slice.call(arguments))};var P={v:undefined,h:undefined};R.v=function(){P.v=Array.prototype.slice.call(arguments);return M.fx(Q,undefined,P)};R.h=function(){P.h=Array.prototype.slice.call(arguments);return M.fx(Q,undefined,P)};return R};M.x1Fx=M.xFx("x1");M.x2Fx=M.xFx("x2");M.x3Fx=M.xFx("x3");M.x4Fx=M.xFx("x4");M.x5Fx=M.xFx("x5");M.x6Fx=M.xFx("x6");M.x7Fx=M.xFx("x7");M.x8Fx=M.xFx("x8");M.x9Fx=M.xFx("x9");M.x10Fx=M.xFx("x10");var K=[M.hFx,M.vFx,M.x1Fx,M.x2Fx,M.x3Fx,M.x4Fx,M.x5Fx,M.x6Fx,M.x7Fx,M.x8Fx,M.x9Fx,M.x10Fx];Array.prototype.push.apply(K,L);var N=O.apply(null,K);if(N){wncd.program(N)}return J}});m.context={impl:{},html:function(J){if(J===undefined){if(m.context.fxCtx&&k.isFunction(m.context.fxCtx.html)){return m.context.fxCtx.html()}else{if(m.context.impl.html){return m.context.impl.html}else{return f.html}}}else{if(m.context.fxCtx&&k.isFunction(m.context.fxCtx.html)){m.context.fxCtx.html(J)}m.context.impl.html=J;return m.context}}};m.grille=v.grille;m.tortue=v.tortue;m.panier=f.panier;m.formulaire=f.formulaire;m.serveur=f.serveur;m.div=function(K,J){return v.div(K,J)};m.html=function(){return v};m.mainDiv=m.html;m.currentDiv=function(){return m.context.html()};m.out=function(K,J){m.currentDiv().out(K,J);return m};m.h1=function(K,J){m.currentDiv().h1(K,J);return m};m.p=function(J){m.currentDiv().p(J);return m};m.$p=function(){m.currentDiv().$p();return m};m.b=function(J){m.currentDiv().b(J);return m};m.i=function(J){m.currentDiv().i(J);return m};m.u=function(J){m.currentDiv().u(J);return m};m.a=function(J){m.currentDiv().a(J);return m};m.color=function(L,K,J){m.currentDiv().color(L,K,J);return m};m.$color=function(){m.currentDiv().$color();return m};m.bouton=function(K,L,J){m.currentDiv().bouton(K,L,J);return m};m.codeSource=function(){return m.context.codeSource};m.libSource=g;m.libPublic=t;m.txtDate=E().txtDate;m.txtFrenchDate=E().txtFrenchDate;m.createSelectionSense=E().createSelectionSense;m.bindSelectionSense=E().bindSelectionSense;m.createCountingSense=E().createCountingSense;m.bindCountingSense=E().bindCountingSense;f.programme=m;f.sousProgramme=D;f.fx=h;f.fx_s=w;f.createFxContext=F;f.ctlSeq=B;f.sequence=B;f.sequence.ajouter=f.sequence.addFx;f.sequence.fin=f.sequence.toFx;f.scripte=u;f.exemple=n;f.ctlGen=d;f.codePublic=C;f.codeSource=q;f.libPublic=t;f.libSource=g;f.menu=c;f.pause=l;f.boutonDePause=a;f.bouton=x;f.tortue=z;f.grille=H;f.program=f.programme;f.subProgram=f.sousProgramme;f.sequence.add=f.sequence.addFx;f.sequence.end=f.sequence.toFx;f.script=f.scripte;f.example=f.exemple;f.buttonPause=f.boutonDePause;f.button=f.bouton;f.turtle=f.tortue;f.grid=f.grille;if(G.publishNcdEtpFxToWncd===undefined){G.publishNcdEtpFxToWncd=function(J,K){if(G.publishNcdEtpToWncd){G.publishNcdEtpToWncd(J,K)}K.div=J.program.div;K.currentDiv=J.program.currentDiv}}if(!o.wncd){o.wncd={}}if(G.publishNcdEtpFxToWncd){G.publishNcdEtpFxToWncd(f,o.wncd)}if(G.publishNcdEtpToWindow){G.publishNcdEtpToWindow(f,o)}if(G.ncdEtpFxReady===undefined){G.ncdEtpFxReady=function(J){var K=k("#footer");if(K.length>0){K.append("<span><i>, Wigii NCD Fx loaded</i></span>")}}}if(G.ncdEtpFxReady){G.ncdEtpFxReady(f)}})(window,jQuery,wigiiNcd,wigiiNcdEtp);if(!wncd.externals){wncd.externals={};
/*!
 * Prism 1.9.0: Lightweight, robust, elegant syntax highlighting (http://prismjs.com)
 * @author Lea Verou http://lea.verou.me
 * @license MIT license http://www.opensource.org/licenses/mit-license.php/
 * Packaged Prism library as a wncd external library by camille@wigii.org on 12.12.2017
 */
}wncd.externals.Prism=(function(a){var e=/\blang(?:uage)?-(\w+)\b/i;var g=0;var d=a.Prism={manual:true,disableWorkerMessageHandler:a.Prism&&a.Prism.disableWorkerMessageHandler,util:{encode:function(h){if(h instanceof f){return new f(h.type,d.util.encode(h.content),h.alias)}else{if(d.util.type(h)==="Array"){return h.map(d.util.encode)}else{return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")}}},type:function(h){return Object.prototype.toString.call(h).match(/\[object (\w+)\]/)[1]},objId:function(h){if(!h.__id){Object.defineProperty(h,"__id",{value:++g})}return h.__id},clone:function(k){var j=d.util.type(k);switch(j){case"Object":var l={};for(var h in k){if(k.hasOwnProperty(h)){l[h]=d.util.clone(k[h])}}return l;case"Array":return k.map(function(m){return d.util.clone(m)})}return k}},languages:{extend:function(l,h){var k=d.util.clone(d.languages[l]);for(var j in h){k[j]=h[j]}return k},insertBefore:function(h,q,o,k){k=k||d.languages;var j=k[h];if(arguments.length==2){o=arguments[1];for(var n in o){if(o.hasOwnProperty(n)){j[n]=o[n]}}return j}var l={};for(var m in j){if(j.hasOwnProperty(m)){if(m==q){for(var n in o){if(o.hasOwnProperty(n)){l[n]=o[n]}}}l[m]=j[m]}}d.languages.DFS(d.languages,function(r,s){if(s===k[h]&&r!=h){this[r]=l}});return k[h]=l},DFS:function(l,m,k,h){h=h||{};for(var j in l){if(l.hasOwnProperty(j)){m.call(l,j,l[j],k||j);if(d.util.type(l[j])==="Object"&&!h[d.util.objId(l[j])]){h[d.util.objId(l[j])]=true;d.languages.DFS(l[j],m,null,h)}else{if(d.util.type(l[j])==="Array"&&!h[d.util.objId(l[j])]){h[d.util.objId(l[j])]=true;d.languages.DFS(l[j],m,j,h)}}}}}},plugins:{},highlightAll:function(h,j){d.highlightAllUnder(document,h,j)},highlightAllUnder:function(h,m,o){var l={callback:o,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};d.hooks.run("before-highlightall",l);var n=l.elements||h.querySelectorAll(l.selector);for(var k=0,j;j=n[k++];){d.highlightElement(j,m===true,l.callback)}},highlightElement:function(n,l,r){var m,h,q=n;while(q&&!e.test(q.className)){q=q.parentNode}if(q){m=(q.className.match(e)||[,""])[1].toLowerCase();h=d.languages[m]}n.className=n.className.replace(e,"").replace(/\s+/g," ")+" language-"+m;if(n.parentNode){q=n.parentNode;if(/pre/i.test(q.nodeName)){q.className=q.className.replace(e,"").replace(/\s+/g," ")+" language-"+m}}var j=n.textContent;var o={element:n,language:m,grammar:h,code:j};d.hooks.run("before-sanity-check",o);if(!o.code||!o.grammar){if(o.code){d.hooks.run("before-highlight",o);o.element.textContent=o.code;d.hooks.run("after-highlight",o)}d.hooks.run("complete",o);return}d.hooks.run("before-highlight",o);if(l&&a.Worker){var k=new Worker(d.filename);k.onmessage=function(s){o.highlightedCode=s.data;d.hooks.run("before-insert",o);o.element.innerHTML=o.highlightedCode;r&&r.call(o.element);d.hooks.run("after-highlight",o);d.hooks.run("complete",o)};k.postMessage(JSON.stringify({language:o.language,code:o.code,immediateClose:true}))}else{o.highlightedCode=d.highlight(o.code,o.grammar,o.language);d.hooks.run("before-insert",o);o.element.innerHTML=o.highlightedCode;r&&r.call(n);d.hooks.run("after-highlight",o);d.hooks.run("complete",o)}},highlight:function(k,h,l){var j=d.tokenize(k,h);return f.stringify(d.util.encode(j),l)},matchGrammar:function(y,H,N,t,Q,D,P){var B=d.Token;for(var v in N){if(!N.hasOwnProperty(v)||!N[v]){continue}if(v==P){return}var h=N[v];h=(d.util.type(h)==="Array")?h:[h];for(var I=0;I<h.length;++I){var M=h[I],O=M.inside,K=!!M.lookbehind,u=!!M.greedy,o=0,A=M.alias;if(u&&!M.pattern.global){var s=M.pattern.toString().match(/[imuy]*$/)[0];M.pattern=RegExp(M.pattern.source,s+"g")}M=M.pattern||M;for(var J=t,r=Q;J<H.length;r+=H[J].length,++J){var E=H[J];if(H.length>y.length){return}if(E instanceof B){continue}M.lastIndex=0;var w=M.exec(E),q=1;if(!w&&u&&J!=H.length-1){M.lastIndex=r;w=M.exec(y);if(!w){break}var G=w.index+(K?w[1].length:0),m=w.index+w[0].length,F=J,C=r;for(var L=H.length;F<L&&(C<m||(!H[F].type&&!H[F-1].greedy));++F){C+=H[F].length;if(G>=C){++J;r=C}}if(H[J] instanceof B||H[F-1].greedy){continue}q=F-J;E=y.slice(r,C);w.index-=r}if(!w){if(D){break}continue}if(K){o=w[1].length}var G=w.index+o,w=w[0].slice(o),m=G+w.length,x=E.slice(0,G),n=E.slice(m);var l=[J,q];if(x){++J;r+=x.length;l.push(x)}var z=new B(v,O?d.tokenize(w,O):w,A,w,u);l.push(z);if(n){l.push(n)}Array.prototype.splice.apply(H,l);if(q!=1){d.matchGrammar(y,H,N,J,r,true,v)}if(D){break}}}}},tokenize:function(l,h,n){var m=[l];var k=h.rest;if(k){for(var j in k){h[j]=k[j]}delete h.rest}d.matchGrammar(l,m,h,0,0,false);return m},hooks:{all:{},add:function(j,k){var h=d.hooks.all;h[j]=h[j]||[];h[j].push(k)},run:function(h,k){var l=d.hooks.all[h];if(!l||!l.length){return}for(var j=0,m;m=l[j++];){m(k)}}}};var f=d.Token=function(k,l,h,j,m){this.type=k;this.content=l;this.alias=h;this.length=(j||"").length|0;this.greedy=!!m};f.stringify=function(m,n,l){if(typeof m=="string"){return m}if(d.util.type(m)==="Array"){return m.map(function(o){return f.stringify(o,n,m)}).join("")}var k={type:m.type,content:f.stringify(m.content,n,l),tag:"span",classes:["token",m.type],attributes:{},language:n,parent:l};if(m.alias){var h=d.util.type(m.alias)==="Array"?m.alias:[m.alias];Array.prototype.push.apply(k.classes,h)}d.hooks.run("wrap",k);var j=Object.keys(k.attributes).map(function(o){return o+'="'+(k.attributes[o]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+k.tag+' class="'+k.classes.join(" ")+'"'+(j?" "+j:"")+">"+k.content+"</"+k.tag+">"};if(!a.document){if(!a.addEventListener){return a.Prism}if(!d.disableWorkerMessageHandler){a.addEventListener("message",function(h){var l=JSON.parse(h.data),m=l.language,k=l.code,j=l.immediateClose;a.postMessage(d.highlight(k,d.languages[m],m));if(j){a.close()}},false)}return a.Prism}var c=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();if(c){d.filename=c.src;if(!d.manual&&!c.hasAttribute("data-manual")){if(document.readyState!=="loading"){if(window.requestAnimationFrame){window.requestAnimationFrame(d.highlightAll)}else{window.setTimeout(d.highlightAll,16)}}else{document.addEventListener("DOMContentLoaded",d.highlightAll)}}}return a.Prism})(wncd.externals);wncd.externals.Prism.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:/<!DOCTYPE[\s\S]+?>/i,cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+)/i,inside:{punctuation:[/^=/,{pattern:/(^|[^\\])["']/,lookbehind:true}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i};wncd.externals.Prism.languages.markup.tag.inside["attr-value"].inside.entity=wncd.externals.Prism.languages.markup.entity;wncd.externals.Prism.hooks.add("wrap",function(a){if(a.type==="entity"){a.attributes.title=a.content.replace(/&amp;/,"&")}});wncd.externals.Prism.languages.xml=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.html=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.mathml=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.svg=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(?:;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^{}\s][^{};]*?(?=\s*\{)/,string:{pattern:/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:true},property:/[-_a-z\xA0-\uFFFF][-\w\xA0-\uFFFF]*(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/};wncd.externals.Prism.languages.css.atrule.inside.rest=wncd.externals.Prism.util.clone(wncd.externals.Prism.languages.css);if(wncd.externals.Prism.languages.markup){wncd.externals.Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\s\S]*?>)[\s\S]*?(?=<\/style>)/i,lookbehind:true,inside:wncd.externals.Prism.languages.css,alias:"language-css",greedy:true}});wncd.externals.Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|')(?:\\[\s\S]|(?!\1)[^\\])*\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:wncd.externals.Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:wncd.externals.Prism.languages.css}},alias:"language-css"}},wncd.externals.Prism.languages.markup.tag)}wncd.externals.Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:true},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:true}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:true},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[\w.\\]+/i,lookbehind:true,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(?:true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};wncd.externals.Prism.languages.javascript=wncd.externals.Prism.languages.extend("clike",{keyword:/\b(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(?:0[xX][\dA-Fa-f]+|0[bB][01]+|0[oO][0-7]+|\d*\.?\d+(?:[Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*\()/i,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/});wncd.externals.Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[[^\]\r\n]+]|\\.|[^/\\\[\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:true,greedy:true},"function-variable":{pattern:/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*=\s*(?:function\b|(?:\([^()]*\)|[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*)\s*=>))/i,alias:"function"}});wncd.externals.Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|[^\\`])*`/,greedy:true,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:wncd.externals.Prism.languages.javascript}},string:/[\s\S]+/}}});if(wncd.externals.Prism.languages.markup){wncd.externals.Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\s\S]*?>)[\s\S]*?(?=<\/script>)/i,lookbehind:true,inside:wncd.externals.Prism.languages.javascript,alias:"language-javascript",greedy:true}})}wncd.externals.Prism.languages.js=wncd.externals.Prism.languages.javascript;
/*! END OF PRISM http://prismjs.com */
/*!
  * Wigii Natural Code Development (NCD) standard library
  * Created by Camille Weber (camille@wigii.org), 15.11.2017
  */
wncd.ObjectDoc=function(d,c){var a=this;a.className="ObjectDoc";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className+a.instantiationTime;a.options=c||{};a.context={stack:[],docModel:{libs:{},members:{}}};a.impl={};if(!a.options.noOutput){if(!a.options.docOutput){a.options.docOutput=wncd.currentDiv()}else{if($.type(a.options.docOutput)==="string"||a.options.docOutput.className!="HtmlEmitter"){a.options.docOutput=wncd.html(a.options.docOutput)}}a.$=function(){return a.options.docOutput.$()}}if(a.options.expandLevel===undefined){a.options.expandLevel=1}if(!a.options.nullEmitter){a.options.nullEmitter=wncd.div("nullEmitter")}if(!a.options.privateValues){a.options.privateValues={}}a.options.privateValues.id=true;a.options.privateValues.ctxKey=true;a.options.privateValues.instantiationTime=true;a.options.privateValues.className=true;a.options.privateValues.$=true;if(a.options.privateValues.context===undefined){a.options.privateValues.context=true}if(a.options.privateValues.impl===undefined){a.options.privateValues.impl=true}if(a.options.privateValues.options===undefined){a.options.privateValues.options=true}if(!a.options.onMemberCreation){a.options.onMemberCreation=function(j,h,f,g,e){if(!f.noOutput){f.renderMember(j,h,f,g,e)}}}if(!a.options.renderMember){a.options.renderMember=function(l,k,f,g,e){var j=k.context.docOutput;if(!j){j=f.docOutput}j=j.div(l.uri,"method");if(l.context.expandable){j.out("+","methodExpand")}if(l.modelType==="Class"){j.out("class","classKeyword keyword")}else{if(l.modelType==="Function"){j.out("function","functionKeyword keyword")}}j.out(l.name,"methodName");if(l.context.args){j.out(" ").out(l.context.args);if(l.context.srcCode&&!l.context.expandable){j.out("+","methodSrcExpand");wncd.bindSelectionSense(j.$().find("span.methodSrcExpand"),function(m){if(m.selected()){j.$().find("div.methodSrc").show()}else{j.$().find("div.methodSrc").hide()}})}else{if(l.context.srcCode&&l.modelType==="Class"){j.out("+","classSrcExpand");wncd.bindSelectionSense(j.$().find("span.classSrcExpand"),function(m){if(m.selected()){j.$().find("div.classSrc").show()}else{j.$().find("div.classSrc").hide()}})}}}else{if((l.context.objectType==="number"||l.context.objectType==="string")&&!f.privateValues[l.name]&&l.context.object){j.out(":","typeAssignement").out(l.context.object,"scalarValue")}else{if(l.context.object===f.nullEmitter){j.out(":","typeAssignement").out("undefined","keyword")}else{j.out(":","typeAssignement").out(l.context.objectType,"keyword")}}}j.out(" ","methodEnd");if(l.context.srcCode&&l.modelType==="Class"){j.htmlBuilder().tag("div","class","classSrc").insert(f.renderClassSrc,l.context.srcCode).$tag("div").emit()}if(l.context.expandable){var h=wncd.bindSelectionSense(j.$().find("span.methodExpand"),function(m){if(m.selected()){if(l.context.expand){l.context.expand()}j.$().find("div.methodMembers").show()}else{j.$().find("div.methodMembers").hide()}});j.htmlBuilder().tag("div","class","methodMembers").$tag("div").emit();l.context.docOutput=j.clone(j.$().find("div.methodMembers"));if(e<f.expandLevel){h.selected(true)}l.context.selectionSense=h}else{if(l.context.srcCode){j.htmlBuilder().tag("div","class","methodSrc").insert(f.renderMemberSrc,l.context.srcCode,l.context.comment).$tag("div").emit()}}}}if(!a.options.renderMemberSrc){a.options.renderMemberSrc=function(f,g){var e=wncd.externals.Prism;f=a.impl.normalizeSrcIndentation(f);f=(g?a.impl.normalizeCommentIndentation(g)+"\n":"")+f;wncd.currentDiv().htmlBuilder().tag("pre").tag("code","class","language-js").put(e.highlight(f,e.languages.js)).$tag("code").$tag("pre").emit()}}if(!a.options.renderClassSrc){a.options.renderClassSrc=function(f,g){var e=wncd.externals.Prism;f=a.impl.normalizeSrcIndentation(f);f=(g?a.impl.normalizeCommentIndentation(g)+"\n":"")+f;wncd.currentDiv().htmlBuilder().tag("pre").tag("code","class","language-js").put(e.highlight(f,e.languages.js)).$tag("code").$tag("pre").emit()}}a.impl.qualifier2uri=function(h,g,e){var f="";if(h){f+=h.replace(".","__")}if(g){if(f){f+="__"}f+=g}if(e){if(f){f+="__"}f+=e}return f.replace("$","S")};a.impl.buildQualifiedName=function(h,g,e){var f="";if(h){f+=h}if(g){if(f){f+="."}f+=g}if(e){if(f){f+="."}f+=e}return f};a.impl.extractClassMemberComments=function(e){var f={};var h=/(\/\*\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)\s*([\w]+)[.]([\w.]+)\s*=/g;var g=undefined;while((g=h.exec(e))!==null){f[g[6]]=g[1];f.className=g[5]}return f};a.impl.createObjModel=function(h,g,e){var f={};if(h){f.namespace=h}if(g){f.className=g}if(e){f.name=e}f.uri=a.impl.qualifier2uri(h,g,e);f.qualifiedName=a.impl.buildQualifiedName(h,g,e);f.context={};return f};a.impl.initClassModel=function(e){e.vars={};e.methods={};e.innerClasses={};e.modelType="Class";e.parent=undefined};a.impl.initFunctionModel=function(e){e.args=[];e.returnType=undefined;e.attributes={};e.modelType="Function";e.parent=undefined};a.impl.initVariableModel=function(e){e.type=undefined;e.value=undefined;e.attributes={};e.modelType="Variable";e.parent=undefined};a.impl.initLibModel=function(e){e.members={};e.modelType="Lib"};a.impl.normalizeSrcIndentation=function(j){var f=/[\n\r]([\t ]*)}$/g;var h=f.exec(j);var e=(h?h[1]:"");var g=e+j;if(e.length>0){f=new RegExp("^\\s{0,"+(e.length+1)+"}","gm");g=g.replace(f,"")}return g};a.impl.normalizeCommentIndentation=function(j){var f=/[\n\r]([\t ]*)\*\/$/g;var h=f.exec(j);var e=(h?h[1]:"");var g=e.substr(1)+j;if(e.length>0){f=new RegExp("^\\s{0,"+(e.length)+"}","gm");g=g.replace(f,"")}return g};a.impl.visitObj=function(k,n,f,m){var e=f.stack[m-1];var g=[];for(var l in k){var j=a.impl.createObjModel(e.namespace,(e.modelType==="Class"?e.name:e.className),l);j.context.object=k[l];g.push(j)}if(!n.noSorting){g.sort(function(q,o){if(q.name<o.name){return -1}else{if(q.name>o.name){return 1}else{return 0}}})}if(n.expandLevel>0){for(var h=0;h<g.length;h++){var j=g[h];a.impl.visitObjMember(j,n,f,m)}}a.context.stack.pop()};a.impl.visitObjMember=function(n,u,h,r){var g=h.stack[r-1];var f=$.type(n.context.object);var k=undefined;var o=undefined;var e=false;var j=false;var q=undefined;if(f==="function"){k=wncd.obj2FxString(n.context.object);o=k.match(/^function\s*(\([^\(\)]*\))/);if(o){o=o[1]}j=/^function\s*\([^\(\)]*\)\s*\{\s*var\s*self\s*=\s*this;/.test(k);q=a.impl.extractClassMemberComments(k);if(j){var m={};var l=Array(n.context.object.length).fill(u.nullEmitter);var t=wncd.currentDiv();try{wncd.program.context.html(u.nullEmitter);n.context.object.apply(m,l);wncd.program.context.html(t);u.nullEmitter.reset()}catch(s){wncd.program.context.html(t)}if(!m.className){m.className=n.name}n.context.object=m}e=(Object.keys(n.context.object).length>0)}else{if(f==="object"&&n.context.object!==u.nullEmitter){e=(Object.keys(n.context.object).length>0)}}if(j){a.impl.initClassModel(n);n.context.srcCode=k;n.context.args=o;n.context.classMemberComments=q}else{if(f==="function"){a.impl.initFunctionModel(n);n.context.srcCode=k;n.context.args=o}else{a.impl.initVariableModel(n);n.context.objectType=f}}n.context.expandable=e;if(g.context.classMemberComments){n.context.comment=g.context.classMemberComments[n.name]}if(u.privateValues[n.name]){n.context.expandable=false}if(g.modelType==="Lib"){g.members[n.name]=n}else{if(g.modelType==="Class"){if(n.modelType==="Variable"){g.vars[n.name]=n}else{if(n.modelType==="Function"){g.methods[n.name]=n}else{if(n.modelType==="Class"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.innerClasses[n.name]=n}}}}else{if(g.modelType==="Function"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.attributes[n.name]=n}else{if(g.modelType==="Variable"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.attributes[n.name]=n}}}}h.docModel.members[n.qualifiedName]=n;n.parent=g;if(n.context.expandable){n.context.expand=function(){n.context.expand=undefined;h.stack.push(n);a.impl.visitObj(n.context.object,u,h,h.stack.length)}}if(u.onMemberCreation){u.onMemberCreation(n,g,u,h,r)}if(r<u.expandLevel&&n.context.expand){n.context.expand()}};a.buildDocModel=function(g,f,e){if(g){var h=a.impl.createObjModel(f,undefined,e);if(e){a.impl.initClassModel(h)}else{a.impl.initLibModel(h)}a.context.stack.push(h);a.impl.visitObj(g,a.options,a.context,1);if(h.modelType==="Lib"){a.context.docModel.libs[h.namespace]=h}a.context.docModel.members[h.qualifiedName]=h}return a.context.docModel};a.buildDocModel(d,a.options.namespace,a.options.className)};wncd.createObjectDoc=function(c,a){return new wncd.ObjectDoc(c,a)};wncd.ContextualMenu=function(d,e,c){var a=this;a.className="ContextualMenu";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className+a.instantiationTime;a.options=c||{};a.context={isVisible:false,rootMenu:a,openMenu:undefined};a.impl={};a.impl.SubMenu=function(j,h,k,g){var f=this;f.className="SubMenu";f.instantiationTime=Date.now();f.ctxKey=wncd.ctxKey+"_"+f.className+f.instantiationTime;f.options=Object.assign({},j.options,g);f.context={isVisible:false,rootMenu:j.context.rootMenu,openMenu:undefined,parent:j,label:h};f.impl={};f.impl.createSubMenu=function(m,n,l){return new f.context.rootMenu.impl.SubMenu(f,m,n,l)};if($.isFunction(k)){f.impl.compose=function(o,m){var l=k(o,f.impl.createSubMenu,m);if($.type(l)==="object"&&l.className=="SubMenu"){l.ctxKey+=o;l.context.itemNumber=o+1}return l}}else{if($.isArray(k)){f.impl.compose=function(o,m){if(o<k.length){var l=k[o];if($.type(l)==="object"&&l[f.options.subMenuField]){l=f.impl.createSubMenu(l[f.options.labelField],l[f.options.subMenuField],f.options);l.ctxKey+=o;l.context.itemNumber=o+1}return l}}}else{throw wncd.createServiceException("compose should be an array or a function",wncd.errorCodes.INVALID_ARGUMENT)}}f.$=function(){return $("#"+f.ctxKey)};f.show=function(){if(!f.context.list){f.context.list=wncd.html(f.$()).list(f.impl.compose,f.options.render,f.options);f.context.list.context.menu=f;f.options.top=f.$().prev().position().top;f.options.positionMenu(f.context.parent,f.options);f.$().css("top",f.options.top).css("left",f.options.left)}if(!f.context.isVisible){f.$().show();f.context.isVisible=true}};f.hide=function(l){if(f.context.isVisible){if(f.context.openMenu){f.context.openMenu.hide();f.context.openMenu=undefined}f.$().hide();f.context.isVisible=false;if(l&&f.context.parent){f.context.parent.hide(l)}}};f.toggle=function(){if(f.context.isVisible){f.hide()}else{f.show()}}};a.impl.createSubMenu=function(g,h,f){return new a.impl.SubMenu(a,g,h,f)};if(!a.options.labelField){a.options.labelField="label"}if(!a.options.subMenuField){a.options.subMenuField="subMenu"}if($.isFunction(e)){a.impl.compose=function(h,g){var f=e(h,a.impl.createSubMenu,g);if($.type(f)==="object"&&f.className=="SubMenu"){f.ctxKey+=h;f.context.itemNumber=h+1}return f}}else{if($.isArray(e)){a.impl.compose=function(h,g){if(h<e.length){var f=e[h];if($.type(f)==="object"&&f[a.options.subMenuField]){f=a.impl.createSubMenu(f[a.options.labelField],f[a.options.subMenuField],a.options);f.ctxKey+=h;f.context.itemNumber=h+1}return f}}}else{throw wncd.createServiceException("compose should be an array or a function",wncd.errorCodes.INVALID_ARGUMENT)}}a.options.maxSelection=1;if(!a.options.rightMenuLabel){a.options.rightMenuLabel="&#9654;"}if(!a.options.positionMenu){a.options.positionMenu=function(h,g){if(h.className=="ContextualMenu"||h.className=="SubMenu"){var j=h.$();g.left=j.width()}else{var f=h.position();g.top=f.top+(g.top?g.top:0);g.left=f.left+(g.left?g.left:0)}}}if(!a.options.buildMenuPanel){a.options.buildMenuPanel=function(h,f){var g="position:absolute;display:none;";if(f.top){g+="top:"+Math.ceil(f.top)+"px;"}if(f.left){g+="left:"+Math.ceil(f.left)+"px;"}return wncd.getHtmlBuilder().tag("div","id",h,"class","contextualMenu"+(f.cssClass?" "+f.cssClass:""),"style",g).$tag("div").html()}}if(!a.options.render){a.options.render=function(g,j,k){var f=k.options;if($.type(j)==="object"&&j.className=="SubMenu"){var h="position:absolute;display:none;";if(f.top){h+="top:"+Math.ceil(f.top)+"px;"}if(f.left){h+="left:"+Math.ceil(f.left)+"px;"}return wncd.getHtmlBuilder().tag("span","class","label").out(j.context.label).$tag("span").tag("span","class","rightMenu").out(a.options.rightMenuLabel).$tag("span").tag("div","id",j.ctxKey,"style",h).$tag("div").html()}else{if($.type(j)==="object"&&j[f.labelField]){return wncd.getHtmlBuilder().tag("span","class","label").out(j[f.labelField]).$tag("span").tag("span","class","noMenu").out("&nbsp;").$tag("span").html()}else{return wncd.getHtmlBuilder().tag("span","class","label").out(j).$tag("span").tag("span","class","noMenu").out("&nbsp;").$tag("span").html()}}}}if(a.options.onItemClick){a.impl.onItemClick=a.options.onItemClick}a.options.onItemClick=function(f,h,g,j){if($.type(h)==="object"&&h.className=="SubMenu"){if(h.context.isVisible){h.hide();j.context.menu.context.openMenu=undefined}else{if(j.context.menu.context.openMenu){j.context.menu.context.openMenu.hide()}h.show();j.context.menu.context.openMenu=h}}else{j.context.menu.hide(true);var k=j.context.menu.context.rootMenu.impl.onItemClick;if($.isFunction(k)){k(f,h,g,j)}}};a.$=function(){return $("#"+a.ctxKey)};a.show=function(){if(!a.context.isVisible){a.$().show();a.context.isVisible=true}};a.hide=function(){if(a.context.isVisible){if(a.context.openMenu){a.context.openMenu.hide();a.context.openMenu=undefined}a.$().hide();a.context.isVisible=false}};a.toggle=function(){if(a.context.isVisible){a.hide()}else{a.show()}};if(!d){throw wncd.createServiceException("anchor should point to an existing DOM element",wncd.errorCodes.INVALID_ARGUMENT)}d=$(d);d.css("position","relative");d.parent().css("position","relative").css("overflow","visible");a.options.positionMenu(d,a.options);d.after(a.options.buildMenuPanel(a.ctxKey,a.options));a.context.list=wncd.html(a.$()).list(a.impl.compose,a.options.render,a.options);a.context.list.context.menu=a;d.click(a.toggle)};wncd.getJQueryService().menu=function(d,a){var c=undefined;if(d&&d.length==1){var f=undefined;var e=$.type(a);if(e==="array"||e==="function"){f=a;a=undefined}else{if(e==="object"){f=a.compose}}c=new wncd.ContextualMenu(d,f,a)}else{if(d&&d.length>1){throw wncd.createServiceException("Wigii NCD menu selector can only be activated on a JQuery collection containing one element and not "+d.length,wncd.errorCodes.INVALID_ARGUMENT)}}return(!c?{$:d}:c)};wncd.Desktop=function(c){var a=this;a.className="Desktop";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className;a.options=c||{};a.context={components:{},currentComponent:undefined};a.impl={onCloseSubscribers:[],onActivateSubscribers:[]};if(!a.options.userMenuLabel){a.options.userMenuLabel="&#9776;"}if(!a.options.label){a.options.label="&#127968;"}if(!a.options.title){a.options.title="&nbsp;"}a.options.obj=a;if(!a.options.height){a.options.height="100%"}if(!a.options.width){a.options.width="100%"}if(!a.options.logo){a.options.logo=wncd.getHtmlBuilder().tag("img","class","logo","src","https://rise.wigii.org/NCD/CMS/www/etp/logo_wigii_48.gif").$tag("img").html()}if(!a.options.htmlEmitter){a.options.htmlEmitter=wncd.currentDiv()}else{if($.type(a.options.htmlEmitter)==="string"||a.options.htmlEmitter.className!="HtmlEmitter"){a.options.htmlEmitter=wncd.html(a.options.htmlEmitter)}}if(!a.options.displayHeaderBar){a.options.displayHeaderBar=function(d){wncd.currentDiv().reset()}}if(!a.options.displayWorkzone){a.options.displayWorkzone=function(d){wncd.currentDiv().reset()}}if(!a.options.displayFooterBar){a.options.displayFooterBar=function(e){var d="";if(program.context.startupLog){if(program.context.startupLog.ncdEtpReady){d+="Wigii NCD core v."+program.context.startupLog.version}if(program.context.startupLog.ncdEtpFxReady){d+=(d?", ":"")+"Fx layer ready "+wncd.txtDate(new Date())}}a.context.startupLog=d;wncd.currentDiv().reset().out(a.context.startupLog)}}if(!a.options.displayUserMenu){a.options.displayUserMenu=function(e){a.context.userMenu=[];for(var d in a.context.components){a.context.userMenu.push(d)}wncd.currentDiv().reset().out(a.options.userMenuLabel,"userMenuButton").$().find("span.userMenuButton").wncd("menu",{compose:function(j,f,h){if(j<a.context.userMenu.length){var g=a.context.components[a.context.userMenu[j]];if(g.options&&g.options.label){g.label=g.options.label}else{g.label=g.key}return g}},onItemClick:function(g,f){a.activate(f.key)},top:5,left:20,cssClass:"userMenu"})}}if(!a.options.layoutDesktop){a.options.layoutDesktop=function(g,m,f,e,d,s,q,n,l,k,j,o,r){return m(d.h(f.h(f(a.options.logo||"&nbsp;"),f().id(r.ctxKey+"_userMenu").cssClass("userMenuContainer")),o.v(f().id(r.ctxKey+"_titleBar").cssClass("titleBar"),d().id(r.ctxKey+"_headerBar").cssClass("headerBar"))),o().id(r.ctxKey+"_workzone").cssClass("workzone"),f().id(r.ctxKey+"_footerBar").cssClass("footerBar")).cssClass("desktop").width(r.options.width).height(r.options.height)}}a.registerComponent=function(f,h,e,g,d){a.context.components[f]={key:f,displayHeaderBar:h,displayWorkzone:e,displayFooterBar:g,options:d};wncd.program.context.html(a.options.userMenuEmitter);a.options.displayUserMenu(a);return a};a.add=function(e,d){var f=wncd[e];if(!$.isFunction(f)){throw wncd.createServiceException("Unsupported class "+e,wncd.errorCodes.UNSUPPORTED_OPERATION)}new f(a,d);return a};a.activate=function(e){if(!e){throw wncd.createServiceException("key cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}var d=a.context.components[e];if(!d){throw wncd.createServiceException("no component registered under key "+e,wncd.errorCodes.INVALID_ARGUMENT)}if(a.context.currentComponent){a.onClose()}a.context.currentComponent=e;a.onActivate();a.options.titleBarEmitter.reset().out(d.options.title||"&nbsp;");if($.isFunction(d.displayHeaderBar)){wncd.program.context.html(a.options.headerBarEmitter);d.displayHeaderBar(a)}if($.isFunction(d.displayWorkzone)){wncd.program.context.html(a.options.workzoneEmitter);d.displayWorkzone(a)}if($.isFunction(d.displayFooterBar)){wncd.program.context.html(a.options.footerBarEmitter);d.displayFooterBar(a)}wncd.program.context.html(a.options.workzoneEmitter);return a.getComponentObject(e)};a.getComponentObject=function(e){if(!e){throw wncd.createServiceException("key cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}var d=a.context.components[e];if(!d){throw wncd.createServiceException("no component registered under key "+e,wncd.errorCodes.INVALID_ARGUMENT)}if(d.options){return d.options.obj}};a.closeCurrentComponent=function(){a.activate(a.ctxKey)};a.onClose=function(f){if($.isFunction(f)){a.impl.onCloseSubscribers.push(f)}else{if(f===undefined){for(var d=0;d<a.impl.onCloseSubscribers.length;d++){var e=a.impl.onCloseSubscribers[d];if($.isFunction(e)){e(a.context.currentComponent,a)}}}}return a};a.onActivate=function(e){if($.isFunction(e)){a.impl.onActivateSubscribers.push(e)}else{if(e===undefined){for(var d=0;d<a.impl.onActivateSubscribers.length;d++){var f=a.impl.onActivateSubscribers[d];if($.isFunction(f)){f(a.context.currentComponent,a)}}}}return a};a.options.htmlEmitter.layout(a.options.layoutDesktop,a);a.options.userMenuEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_userMenu"));a.options.titleBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_titleBar"));a.options.headerBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_headerBar"));a.options.workzoneEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_workzone"));a.options.footerBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_footerBar"));a.registerComponent(a.ctxKey,a.options.displayHeaderBar,a.options.displayWorkzone,a.options.displayFooterBar,a.options);a.activate(a.ctxKey)};wncd.createDesktop=function(a){return new wncd.Desktop(a)};